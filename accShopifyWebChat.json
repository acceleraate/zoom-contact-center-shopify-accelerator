{"flowName":"accShopifyWebChat","studioType":1,"desc":"Calls Shopify Admin API to retrieve customer/order data and populate Zoom custom variables. Accelerator provided by Acceleraate Ltd - acceleraate.com","versionDesc":"","status":1,"version":7,"eventAction":"{\"eventActions\":[]}","widgetsJson":"{\"state\":[{\"id\":\"40324010-2cf6-4380-89ea-35256a1a8ad0\",\"name\":\"Start\",\"type\":\"Start\",\"top\":-584,\"left\":-3964.714285714286,\"start\":true,\"acceptable\":false,\"properties\":{},\"transitions\":[{\"event\":\"Web Chat\",\"next\":\"FlowConfig\",\"friendlyName\":\"Web Chat\",\"id\":\"777bb5b5-2359-432f-978a-29ac62d22d90\"}]},{\"id\":\"717b5876-cad4-4899-9ad5-328848d24411\",\"name\":\"GetCustomer\",\"type\":\"Variable\",\"top\":194,\"left\":956,\"properties\":{\"script\":\"/*\\nINPUT PARAMETERS FOR DEBUGGING\\n\\n{\\n\\\"global_custom.accShopify.apiKey\\\":\\\"TESTKEY\\\",\\n\\\"global_custom.accShopify.storeName\\\":\\\"test-store\\\",\\n\\\"global_custom.accShopify.customerEmail\\\":\\\"xxx@yyy.com\\\",\\n\\\"GetSearchMethod.value\\\":\\\"customerByEmail\\\",\\n\\\"ProcessOrder.customerId\\\":\\\"6629291852093\\\"\\n}\\n\\n*/\\n\\nasync function main () {\\n  const scriptBlockName = \\\"GetCustomer\\\";\\n  let response;\\n  \\n  try {\\n    let shopifyApiKey = var_get()[\\\"global_custom.accShopify.apiKey\\\"];\\n    let shopifyStoreName = var_get()[\\\"global_custom.accShopify.storeName\\\"];\\n        \\n    let email = var_get()[\\\"global_custom.accShopify.customerEmail\\\"];\\n    let phone = var_get()[\\\"global_custom.accShopify.customerPhone\\\"];\\n    let customerId = var_get()[\\\"ProcessOrder.customerId\\\"];\\n    let searchMethod = var_get()[\\\"GetSearchMethod.value\\\"];\\n\\n    // set the endpoint url based on the search method\\n    let shopifyApiCustomerEndpoint = (searchMethod == \\\"orderByNumber\\\") ? `https://${shopifyStoreName}.myshopify.com//admin/api/2022-10/customers/${customerId}.json` : `https://${shopifyStoreName}.myshopify.com/admin/api/2022-10/customers/search.json`;\\n            \\n    let result;\\n    \\n    // search for the customer using the supplied parameters\\n    if (searchMethod == \\\"customerByEmail\\\") {\\n      result = await req.get(shopifyApiCustomerEndpoint, {\\n        headers: {\\n          'X-Shopify-Access-Token': shopifyApiKey,\\n          'Content-Type': 'application/json'\\n        },\\n        params: {\\n          'email': email\\n        }\\n      });\\n    } else if (searchMethod == \\\"customerByPhone\\\") {\\n      result = await req.get(shopifyApiCustomerEndpoint, {\\n        headers: {\\n          'X-Shopify-Access-Token': shopifyApiKey,\\n          'Content-Type': 'application/json'\\n        },\\n        params: {\\n          'phone': phone\\n        }\\n      });      \\n    } else {\\n      result = await req.get(shopifyApiCustomerEndpoint, {\\n        headers: {\\n          'X-Shopify-Access-Token': shopifyApiKey,\\n          'Content-Type': 'application/json'\\n        }\\n      });\\n    }\\n    \\n    // customer search methods return an array, so strip out the returned object\\n    if (searchMethod == \\\"customerByEmail\\\" || searchMethod == \\\"customerByPhone\\\") {\\n      if (result.data.customers.length > 0){\\n        response = result.data.customers[0];  // Store the API response\\n      } else {\\n        // no data returned so set error variables based on the search method\\n        if (searchMethod == \\\"customerByEmail\\\") {\\n          global_var_set(\\\"global_custom.accShopify.errorCode\\\",3001);\\n          global_var_set(\\\"global_custom.accShopify.errorMessage\\\",\\\"Customer not found using email address\\\" + \\\" - [flow: \\\" + var_get()[\\\"FlowConfig.name\\\"] + \\\"] - [version: \\\" + var_get()[\\\"FlowConfig.version\\\"] + \\\"] - [block: \\\" + scriptBlockName + \\\"]\\\");\\n        } else if (searchMethod == \\\"customerByPhone\\\") {\\n          global_var_set(\\\"global_custom.accShopify.errorCode\\\",3002);\\n          global_var_set(\\\"global_custom.accShopify.errorMessage\\\",\\\"Customer not found using phone number\\\" + \\\" - [flow: \\\" + var_get()[\\\"FlowConfig.name\\\"] + \\\"] - [version: \\\" + var_get()[\\\"FlowConfig.version\\\"] + \\\"] - [block: \\\" + scriptBlockName + \\\"]\\\");\\n        }\\n        return false;\\n      }\\n    } else if (searchMethod == \\\"orderByNumber\\\") {\\n      // successful order lookups already have the customer ID so only 1 object is in the response to return\\n      response = result.data.customer;\\n    }\\n    var_set(\\\"data\\\",JSON.stringify(response));\\n    return true;\\n    \\n  } catch (error) {\\n    log.debug(\\\"Unexpected error: \\\" + error + \\\" - [flow: \\\" + var_get()[\\\"FlowConfig.name\\\"] + \\\"] - [version: \\\" + var_get()[\\\"FlowConfig.version\\\"] + \\\"] - [block: \\\" + scriptBlockName + \\\"]\\\");\\n    global_var_set(\\\"global_custom.accShopify.errorCode\\\",9000);\\n    global_var_set(\\\"global_custom.accShopify.errorMessage\\\",\\\"Unexpected error: \\\" + error + \\\" - [flow: \\\" + var_get()[\\\"FlowConfig.name\\\"] + \\\"] - [version: \\\" + var_get()[\\\"FlowConfig.version\\\"] + \\\"] - [block: \\\" + scriptBlockName + \\\"]\\\");\\n    return false;\\n  }\\n}\\n\",\"language\":\"javascript\",\"name\":\"GetCustomer\",\"sdkVersion\":2},\"transitions\":[{\"event\":\"Success\",\"next\":\"CheckCustomerFound\",\"id\":\"1998d549-4bce-4795-8487-0982c8eb1863\",\"friendlyName\":\"Success\"},{\"event\":\"Fail\",\"friendlyName\":\"Fail\",\"next\":\"DisplayError\",\"id\":\"f5f209e8-4909-448d-aa5c-521ed67e9340\"}]},{\"id\":\"1d2766f0-c46b-45de-bcbe-f862af77d07b\",\"name\":\"ProcessCustomer\",\"type\":\"Variable\",\"top\":692,\"left\":1339,\"properties\":{\"script\":\"/*\\nINPUT PARAMETERS FOR DEBUGGING\\n\\n{\\n'GetCustomer.data':'{\\\"id\\\": 6629291852093,\\\"email\\\": \\\"xxx@yyy.com\\\",\\\"first_name\\\": \\\"Test\\\",\\\"last_name\\\": \\\"Tester\\\"}',\\n'FlowConfig.name':'TestFlow'\\n}\\n\\n*/\\n\\nasync function main () {\\n  const scriptBlockName = \\\"ProcessCustomer\\\";\\n\\n  try {\\n    let response = JSON.parse(var_get()[\\\"GetCustomer.data\\\"]);\\n\\n    // popluate the custom variables\\n    global_var_set(\\\"global_custom.accShopify.customerId\\\", response.id);\\n    global_var_set(\\\"global_custom.accShopify.customerEmail\\\", response.email);\\n    global_var_set(\\\"global_custom.accShopify.customerFirstName\\\", response.first_name);\\n    global_var_set(\\\"global_custom.accShopify.customerLastName\\\", response.last_name);\\n    global_var_set(\\\"global_custom.accShopify.customerPhone\\\", response.phone);\\n    global_var_set(\\\"global_custom.accShopify.customerOrdersCount\\\", response.orders_count);\\n    global_var_set(\\\"global_custom.accShopify.customerLastOrderId\\\", response.last_order_id);\\n    global_var_set(\\\"global_custom.accShopify.customerNote\\\", response.note);\\n    global_var_set(\\\"global_custom.accShopify.customerState\\\", response.state);\\n    global_var_set(\\\"global_custom.accShopify.customerTags\\\", response.tags);\\n    global_var_set(\\\"global_custom.accShopify.customerTotalSpent\\\", response.total_spent);\\n    \\n    return true;\\n    \\n  } catch (error) {\\n    log.debug(\\\"Unexpected error: \\\" + error + \\\" - [flow: \\\" + var_get()[\\\"FlowConfig.name\\\"] + \\\"] - [version: \\\" + var_get()[\\\"FlowConfig.version\\\"] + \\\"] - [block: \\\" + scriptBlockName + \\\"]\\\");\\n    global_var_set(\\\"global_custom.accShopify.errorCode\\\",9000);\\n    global_var_set(\\\"global_custom.accShopify.errorMessage\\\",\\\"Unexpected error: \\\" + error + \\\" - [flow: \\\" + var_get()[\\\"FlowConfig.name\\\"] + \\\"] - [version: \\\" + var_get()[\\\"FlowConfig.version\\\"] + \\\"] - [block: \\\" + scriptBlockName + \\\"]\\\");\\n    return false;\\n  }\\n}\\n\",\"language\":\"javascript\",\"name\":\"ProcessCustomer\",\"sdkVersion\":2},\"transitions\":[{\"event\":\"Success\",\"friendlyName\":\"Success\",\"next\":\"CheckProcessing\",\"id\":\"22eb77a8-0807-4f6d-a75d-5b6d58704f1c\"},{\"event\":\"Fail\",\"friendlyName\":\"Fail\",\"next\":\"DisplayError\",\"id\":\"2c45081f-825a-4067-8ef4-c6fb7d3c4601\"}]},{\"id\":\"2ad9d511-456c-464c-b8fd-2a2a5644ddb2\",\"name\":\"CheckProcessing\",\"type\":\"Condition\",\"top\":575,\"left\":2140.6666666666665,\"properties\":{\"type\":\"variable\",\"variable\":\"{{ProcessCustomer.value}}\",\"queueId\":\"\"},\"transitions\":[{\"friendlyName\":\"No Match\",\"event\":\"noMatch\",\"next\":\"DisplayError\",\"id\":\"d6b6c3c9-0ba7-4241-bc91-5917bb196c0f\"},{\"id\":\"6eaddc83-a01a-4ce8-b395-23cea8a42cea\",\"event\":\"Match\",\"condition\":null,\"conditionList\":[{\"value\":\"true\",\"operator\":\"Equal to\",\"preOperator\":\"None\"}],\"friendlyName\":\"True\",\"categoryId\":\"\",\"skillId\":\"\",\"skillName\":\"\",\"next\":\"OrderMissing\"}]},{\"id\":\"dfaa97d7-31f1-442b-8191-ab3f9b60bbcd\",\"name\":\"GetSearchMethod\",\"type\":\"Variable\",\"top\":276,\"left\":447,\"properties\":{\"script\":\"/*\\nINPUT PARAMETERS FOR DEBUGGING\\n\\n{\\n\\\"global_custom.accShopify.searchMethod\\\":\\\"orderByNumber\\\",\\n\\\"global_custom.accShopify.customerEmail\\\":\\\"email@example.com\\\",\\n\\\"FlowConfig.name\\\":\\\"TestFlow\\\"\\n}\\n\\n*/\\n\\nasync function main () {\\n  const scriptBlockName = \\\"GetSearchMethod\\\";\\n  \\n  try {\\n    let searchMethod = var_get()[\\\"global_custom.accShopify.searchMethod\\\"];\\n    if (searchMethod != null && searchMethod != \\\"\\\") {\\n      return searchMethod;\\n    } else {      \\n      // search method not explicitly set, so work our what variables have been set to determine what search method should be used\\n      log.debug(\\\"orderNumber: \\\" + var_get()[\\\"global_custom.accShopify.orderNumber\\\"]);\\n      if (var_get()[\\\"global_custom.accShopify.orderNumber\\\"] != null && var_get()[\\\"global_custom.accShopify.orderNumber\\\"] != \\\"\\\"){\\n        // priority 1 - search by order number\\n        searchMethod = \\\"orderByNumber\\\";\\n        return searchMethod;\\n      }\\n      log.debug(\\\"customerEmail: \\\" + var_get()[\\\"global_custom.accShopify.customerEmail\\\"]);\\n      if (var_get()[\\\"global_custom.accShopify.customerEmail\\\"] != null && var_get()[\\\"global_custom.accShopify.customerEmail\\\"] != \\\"\\\"){\\n        // priority 2 - search by customer email\\n        searchMethod = \\\"customerByEmail\\\";\\n        return searchMethod;\\n      }\\n      log.debug(\\\"customerPhone: \\\" + var_get()[\\\"global_custom.accShopify.customerPhone\\\"]);\\n      if (var_get()[\\\"global_custom.accShopify.customerPhone\\\"] != null && var_get()[\\\"global_custom.accShopify.customerPhone\\\"] != \\\"\\\"){\\n        // priority 3 - search by customer phone\\n        searchMethod = \\\"customerByPhone\\\";\\n        return searchMethod;\\n      }\\n    }\\n    \\n    // no criteria set so set error variables\\n    global_var_set(\\\"global_custom.accShopify.errorCode\\\",1003);\\n    global_var_set(\\\"global_custom.accShopify.errorMessage\\\",\\\"No variables set\\\"  + \\\" - [flow: \\\" + var_get()[\\\"FlowConfig.name\\\"] + \\\"] - [version: \\\" + var_get()[\\\"FlowConfig.version\\\"] + \\\"] - [block: \\\" + scriptBlockName + \\\"]\\\");\\n    return false;\\n     \\n  } catch (error) {\\n    log.debug(\\\"Unexpected error: \\\" + error + \\\" - [flow: \\\" + var_get()[\\\"FlowConfig.name\\\"] + \\\"] - [version: \\\" + var_get()[\\\"FlowConfig.version\\\"] + \\\"] - [block: \\\" + scriptBlockName + \\\"]\\\");\\n    global_var_set(\\\"global_custom.accShopify.errorCode\\\",9000);\\n    global_var_set(\\\"global_custom.accShopify.errorMessage\\\",\\\"Unexpected error: \\\" + error + \\\" - [flow: \\\" + var_get()[\\\"FlowConfig.name\\\"] + \\\"] - [version: \\\" + var_get()[\\\"FlowConfig.version\\\"] + \\\"] - [block: \\\" + scriptBlockName + \\\"]\\\");\\n    return false;\\n  }\\n}\\n\\n\",\"language\":\"javascript\",\"name\":\"GetSearchMethod\",\"sdkVersion\":2},\"transitions\":[{\"event\":\"Success\",\"friendlyName\":\"Success\",\"next\":\"CheckSearchMethod\",\"id\":\"ccdf3f5c-c2ee-4db1-88cd-5302b1238e35\"},{\"event\":\"Fail\",\"friendlyName\":\"Fail\",\"next\":\"DisplayError\",\"id\":\"dfdb6e09-5a4f-49ad-a906-08b40617efc7\"}]},{\"id\":\"cb36b90e-afff-4315-884e-b30abc1b9b69\",\"name\":\"CheckSearchMethod\",\"type\":\"Condition\",\"top\":509,\"left\":447,\"properties\":{\"type\":\"variable\",\"variable\":\"{{GetSearchMethod.value}}\",\"queueId\":\"\"},\"transitions\":[{\"friendlyName\":\"No Match\",\"event\":\"noMatch\",\"next\":\"DisplayError\",\"id\":\"09aa29c0-a347-40f8-8099-4eb7a20f63e4\"},{\"id\":\"88f976c3-6675-4fc4-b3d5-58dcbaae641e\",\"event\":\"Match\",\"condition\":null,\"conditionList\":[{\"value\":\"customerByEmail\",\"operator\":\"Equal to\",\"preOperator\":\"None\"}],\"friendlyName\":\"Customer by email\",\"categoryId\":\"\",\"skillId\":\"\",\"skillName\":\"\",\"next\":\"GetCustomer\"},{\"id\":\"884db645-36b7-42ee-bec0-7c168d1c8011\",\"event\":\"Match\",\"condition\":null,\"conditionList\":[{\"value\":\"customerByPhone\",\"operator\":\"Equal to\",\"preOperator\":\"None\"}],\"friendlyName\":\"Customer by phone\",\"categoryId\":\"\",\"skillId\":\"\",\"skillName\":\"\",\"next\":\"GetCustomer\"},{\"id\":\"72db56af-65cb-4569-8d18-506c97a0becb\",\"event\":\"Match\",\"condition\":null,\"conditionList\":[{\"value\":\"orderByNumber\",\"operator\":\"Equal to\",\"preOperator\":\"None\"}],\"friendlyName\":\"Order by number\",\"categoryId\":\"\",\"skillId\":\"\",\"skillName\":\"\",\"next\":\"GetOrder\"}]},{\"id\":\"0b09c612-138b-4b5a-b565-10571c8d6fad\",\"name\":\"GetOrder\",\"type\":\"Variable\",\"top\":1524,\"left\":903,\"properties\":{\"script\":\"/*\\nINPUT PARAMETERS FOR DEBUGGING\\n\\n{\\n\\\"global_custom.accShopify.apiKey\\\":\\\"TESTKEY\\\",\\n\\\"global_custom.accShopify.storeName\\\":\\\"test-store\\\",\\n\\\"global_custom.accShopify.orderNumber\\\":\\\"1002\\\",\\n\\\"global_custom.accShopify.customerLastOrderId\\\":\\\"5223006142781\\\",\\n\\\"GetSearchMethod.value\\\":\\\"customerByEmail\\\"\\n}\\n\\n*/\\n\\nasync function main () {\\n  const scriptBlockName = \\\"GetOrder\\\";\\n  let response;\\n  \\n  try {\\n    let shopifyApiKey = var_get()[\\\"global_custom.accShopify.apiKey\\\"];\\n    let shopifyStoreName = var_get()[\\\"global_custom.accShopify.storeName\\\"];\\n    \\n    let orderNumber = var_get()[\\\"global_custom.accShopify.orderNumber\\\"]; // this will be the value supplied by the customer\\n    let orderId = var_get()[\\\"global_custom.accShopify.customerLastOrderId\\\"]; // this will be the value from the customer object if searching by customer rather than order\\n    let searchMethod = var_get()[\\\"GetSearchMethod.value\\\"];\\n\\n    // set the endpoint url based on the search method\\n    let shopifyApiOrderEndpoint = (searchMethod == \\\"orderByNumber\\\") ? `https://${shopifyStoreName}.myshopify.com/admin/api/2022-10/orders.json` : `https://${shopifyStoreName}.myshopify.com/admin/api/2022-10/orders/${orderId}.json`;\\n    \\n    let result;\\n    // search for the order using the supplied parameters\\n    if (searchMethod == \\\"orderByNumber\\\") {\\n      result = await req.get(shopifyApiOrderEndpoint, {\\n        headers: {\\n          'X-Shopify-Access-Token': shopifyApiKey,\\n          'Content-Type': 'application/json'\\n        },\\n        params: {\\n          'name': orderNumber,'status': 'any'\\n        }\\n      });\\n    } else {\\n      result = await req.get(shopifyApiOrderEndpoint, {\\n        headers: {\\n          'X-Shopify-Access-Token': shopifyApiKey,\\n          'Content-Type': 'application/json'\\n        }\\n      });\\n    }\\n    \\n    // order search return an array, so strip out the returned object\\n    if (searchMethod == \\\"orderByNumber\\\") {\\n      if (result.data.orders.length > 0){\\n        response = result.data.orders[0];  // Store the API response\\n      } else {\\n        // no data returned so set error variables\\n        global_var_set(\\\"global_custom.accShopify.errorCode\\\",3003);\\n        global_var_set(\\\"global_custom.accShopify.errorMessage\\\",\\\"Order not found\\\" + \\\" - [flow: \\\" + var_get()[\\\"FlowConfig.name\\\"] + \\\"] - [version: \\\" + var_get()[\\\"FlowConfig.version\\\"] + \\\"] - [block: \\\" + scriptBlockName + \\\"]\\\");\\n        return false;\\n      }\\n    } else if (searchMethod.startsWith(\\\"customer\\\")) {\\n      // successful order lookups already have the order ID so only 1 object is in the response to return\\n      response = result.data.order;\\n    } else {\\n      global_var_set(\\\"global_custom.accShopify.errorCode\\\",3003);\\n      global_var_set(\\\"global_custom.accShopify.errorMessage\\\",\\\"Order not found\\\");\\n      return false; \\n    }\\n\\n    var_set(\\\"data\\\",JSON.stringify(response));\\n    log.debug(JSON.stringify(response));\\n    return true;\\n  \\n  } catch (error) {\\n    log.debug(\\\"Unexpected error: \\\" + error + \\\" - [flow: \\\" + var_get()[\\\"FlowConfig.name\\\"] + \\\"] - [version: \\\" + var_get()[\\\"FlowConfig.version\\\"] + \\\"] - [block: \\\" + scriptBlockName + \\\"]\\\");\\n    global_var_set(\\\"global_custom.accShopify.errorCode\\\",9000);\\n    global_var_set(\\\"global_custom.accShopify.errorMessage\\\",\\\"Unexpected error: \\\" + error + \\\" - [flow: \\\" + var_get()[\\\"FlowConfig.name\\\"] + \\\"] - [version: \\\" + var_get()[\\\"FlowConfig.version\\\"] + \\\"] - [block: \\\" + scriptBlockName + \\\"]\\\");\\n    return false;\\n  }\\n}\\n\",\"language\":\"javascript\",\"name\":\"GetOrder\",\"sdkVersion\":2},\"transitions\":[{\"event\":\"Success\",\"next\":\"CheckOrderFound\",\"id\":\"0bdf3668-a9b7-4a0b-9eed-e7be858027f8\",\"friendlyName\":\"Success\"},{\"event\":\"Fail\",\"friendlyName\":\"Fail\",\"next\":\"DisplayError\",\"id\":\"fa41a8b0-8703-42c0-8c49-35ec367cf492\"}]},{\"id\":\"7e1422e3-7cb5-464f-b778-fc94cdb8ba7f\",\"name\":\"ProcessOrder\",\"type\":\"Variable\",\"top\":1095,\"left\":956,\"properties\":{\"script\":\"/*\\nINPUT PARAMETERS FOR DEBUGGING\\n\\n{\\n'GetOrder.data':'{\\\"fulfillment_status\\\":\\\"fulfilled\\\",\\\"customer\\\":{\\\"id\\\":6629291852093}}'\\n}\\n\\n*/\\n\\nasync function main () {\\n  const scriptBlockName = \\\"ProcessOrder\\\";\\n\\n  try {\\n    let response = JSON.parse(var_get()[\\\"GetOrder.data\\\"]);\\n\\n    global_var_set(\\\"global_custom.accShopify.orderId\\\", response.id);\\n    global_var_set(\\\"global_custom.accShopify.orderNumber\\\", response.order_number);\\n    global_var_set(\\\"global_custom.accShopify.orderStatus\\\", response.fulfillment_status);\\n    global_var_set(\\\"global_custom.accShopify.orderPaymentStatus\\\", response.financial_status);\\n    global_var_set(\\\"global_custom.accShopify.orderShippingAddress\\\", JSON.stringify(response.shipping_address));\\n    global_var_set(\\\"global_custom.accShopify.orderCancelReason\\\", response.cancel_reason);\\n    global_var_set(\\\"global_custom.accShopify.orderCancelledAt\\\", response.cancelled_at);\\n    global_var_set(\\\"global_custom.accShopify.orderLineItems\\\", JSON.stringify(response.line_items));\\n    global_var_set(\\\"global_custom.accShopify.orderNote\\\", response.note);\\n    global_var_set(\\\"global_custom.accShopify.orderPhone\\\", response.phone);\\n    global_var_set(\\\"global_custom.accShopify.orderTotalPrice\\\", response.total_price);\\n    // set the customer id from the cut-down customer object, so a full lookup can be done\\n    var_set(\\\"customerId\\\", response.customer.id);\\n    return true;\\n    \\n  } catch (error) {\\n    log.debug(\\\"Unexpected error: \\\" + error + \\\" - [flow: \\\" + var_get()[\\\"FlowConfig.name\\\"] + \\\"] - [version: \\\" + var_get()[\\\"FlowConfig.version\\\"] + \\\"] - [block: \\\" + scriptBlockName + \\\"]\\\");\\n    global_var_set(\\\"global_custom.accShopify.errorCode\\\",9000);\\n    global_var_set(\\\"global_custom.accShopify.errorMessage\\\",\\\"Unexpected error: \\\" + error + \\\" - [flow: \\\" + var_get()[\\\"FlowConfig.name\\\"] + \\\"] - [version: \\\" + var_get()[\\\"FlowConfig.version\\\"] + \\\"] - [block: \\\" + scriptBlockName + \\\"]\\\");\\n    return false;\\n  }\\n}\\n\\nfunction preventNull(valueToCheck){\\n  if (valueToCheck == null) {\\n    return \\\"\\\";\\n  } else {\\n    return valueToCheck;\\n  }\\n}\\n\",\"language\":\"javascript\",\"name\":\"ProcessOrder\",\"sdkVersion\":2},\"transitions\":[{\"event\":\"Success\",\"friendlyName\":\"Success\",\"next\":\"CheckProcessOrder\",\"id\":\"ab965887-546a-416f-bba8-7744c0a591fe\"},{\"event\":\"Fail\",\"friendlyName\":\"Fail\",\"next\":\"DisplayError\",\"id\":\"617a8678-9ba7-4ac1-a7ad-33f92eddb4b0\"}]},{\"id\":\"5008e90d-52ba-431f-a1a6-a244b96e0d6f\",\"name\":\"ValidateSetup\",\"type\":\"Variable\",\"top\":-200,\"left\":644,\"properties\":{\"script\":\"/*\\nINPUT PARAMETERS FOR DEBUGGING\\n\\n{\\n\\\"global_custom.accShopify.apiKey\\\":\\\"TESTKEY\\\",\\n\\\"global_custom.accShopify.storeName\\\":\\\"test-value\\\",\\n\\\"FlowConfig.name\\\":\\\"TestFlow\\\"\\n}\\n\\n*/\\n\\nasync function main () {\\n  \\n  const scriptBlockName = \\\"ValidateSetup\\\";\\n\\n  let shopifyApiKey;\\n  let shopifyStoreName;\\n  \\n  try {\\n    shopifyApiKey = var_get()[\\\"global_custom.accShopify.apiKey\\\"];\\n    shopifyStoreName = var_get()[\\\"global_custom.accShopify.storeName\\\"];\\n\\n    // check we've got all the required values to call the endpoint\\n    if (shopifyApiKey == null){\\n      global_var_set(\\\"global_custom.accShopify.errorCode\\\",1001);\\n      global_var_set(\\\"global_custom.accShopify.errorMessage\\\",\\\"No API Key defined\\\" + \\\" - [flow: \\\" + var_get()[\\\"FlowConfig.name\\\"] + \\\"] - [version: \\\" + var_get()[\\\"FlowConfig.version\\\"] + \\\"] - [block: \\\" + scriptBlockName + \\\"]\\\");\\n      return false;\\n    }\\n    if (shopifyStoreName == null){\\n      global_var_set(\\\"global_custom.accShopify.errorCode\\\",1002);\\n      global_var_set(\\\"global_custom.accShopify.errorMessage\\\",\\\"No Store Name defined\\\" + \\\" - [flow: \\\" + var_get()[\\\"FlowConfig.name\\\"] + \\\"] - [version: \\\" + var_get()[\\\"FlowConfig.version\\\"] + \\\"] - [block: \\\" + scriptBlockName + \\\"]\\\");\\n      return false;\\n    }\\n    // no conditions matched so all OK\\n    return true;\\n  } catch (error) {\\n    log.debug(\\\"Unexpected error: \\\" + error + \\\" - [flow: \\\" + var_get()[\\\"FlowConfig.name\\\"] + \\\"] - [version: \\\" + var_get()[\\\"FlowConfig.version\\\"] + \\\"] - [block: \\\" + scriptBlockName + \\\"]\\\");\\n    global_var_set(\\\"global_custom.accShopify.errorCode\\\",9000);\\n    global_var_set(\\\"global_custom.accShopify.errorMessage\\\",\\\"Unexpected error: \\\" + error + \\\" - [flow: \\\" + var_get()[\\\"FlowConfig.name\\\"] + \\\"] - [version: \\\" + var_get()[\\\"FlowConfig.version\\\"] + \\\"] - [block: \\\" + scriptBlockName + \\\"]\\\");\\n    return false;\\n  }\\n}\\n\",\"language\":\"javascript\",\"name\":\"ValidateSetup\",\"sdkVersion\":2},\"transitions\":[{\"event\":\"Success\",\"friendlyName\":\"Success\",\"next\":\"CheckValidSetup\",\"id\":\"5ebf554e-dfce-4143-887b-04150e96db53\"},{\"event\":\"Fail\",\"friendlyName\":\"Fail\",\"next\":\"DisplayError\",\"id\":\"421ab673-3366-41bd-9ca2-e60361af070c\"}]},{\"id\":\"478ff4e9-f1c3-462d-b2d9-8d7d2cb71707\",\"name\":\"CheckValidSetup\",\"type\":\"Condition\",\"top\":68,\"left\":460,\"properties\":{\"type\":\"variable\",\"variable\":\"{{ValidateSetup.value}}\",\"queueId\":\"\"},\"transitions\":[{\"friendlyName\":\"No Match\",\"event\":\"noMatch\",\"next\":\"DisplayError\",\"id\":\"0a7e4950-6cd9-4bac-9006-a5ac1f6695ba\"},{\"id\":\"79156fee-680c-427d-a5e5-ec87cc9fdd43\",\"event\":\"Match\",\"condition\":null,\"conditionList\":[{\"value\":\"true\",\"operator\":\"Equal to\",\"preOperator\":\"None\"}],\"friendlyName\":\"True\",\"categoryId\":\"\",\"skillId\":\"\",\"skillName\":\"\",\"next\":\"GetSearchMethod\"}]},{\"id\":\"4a22b108-f950-4fad-9ec1-6eb8b9f02048\",\"name\":\"CheckCustomerFound\",\"type\":\"Condition\",\"top\":407,\"left\":1004,\"properties\":{\"type\":\"variable\",\"variable\":\"{{GetCustomer.value}}\",\"queueId\":\"\"},\"transitions\":[{\"friendlyName\":\"No Match\",\"event\":\"noMatch\",\"next\":\"DisplayError\",\"id\":\"f0dd889d-f9a6-47f6-b4bd-1efc5620eacb\"},{\"id\":\"d9633700-e85c-4670-ac6d-aa0c7ebdc09f\",\"event\":\"Match\",\"condition\":null,\"conditionList\":[{\"value\":\"true\",\"operator\":\"Equal to\",\"preOperator\":\"None\"}],\"friendlyName\":\"True\",\"categoryId\":\"\",\"skillId\":\"\",\"skillName\":\"\",\"next\":\"ProcessCustomer\"}]},{\"id\":\"3725848d-0daa-481f-9fc8-cf0df8bd472c\",\"name\":\"CheckOrderFound\",\"type\":\"Condition\",\"top\":1308,\"left\":903,\"properties\":{\"type\":\"variable\",\"variable\":\"{{GetOrder.value}}\",\"queueId\":\"\"},\"transitions\":[{\"friendlyName\":\"No Match\",\"event\":\"noMatch\",\"next\":\"DisplayError\",\"id\":\"0975ece8-b5ab-4e75-af56-ac809a0f8d79\"},{\"id\":\"25decf67-cc20-47a2-9c18-29c7094b9eb0\",\"event\":\"Match\",\"condition\":null,\"conditionList\":[{\"value\":\"true\",\"operator\":\"Equal to\",\"preOperator\":\"None\"}],\"friendlyName\":\"True\",\"categoryId\":\"\",\"skillId\":\"\",\"skillName\":\"\",\"next\":\"ProcessOrder\"}]},{\"id\":\"ede30a47-e91c-4cd1-ad9c-c1e5c0654ac5\",\"name\":\"OrderMissing\",\"type\":\"Variable\",\"top\":827,\"left\":2182,\"properties\":{\"script\":\"/*\\n\\nINPUT PARAMETERS FOR DEBUGGING\\n\\n{\\n\\\"GetOrder.value\\\":\\\"true\\\",\\n\\\"global_custom.accShopify.customerLastOrderId\\\":\\\"123\\\",\\n\\\"FlowConfig.name\\\":\\\"DebugFlow\\\"\\n}\\n\\n*/\\n\\nasync function main () {\\n  const scriptBlockName = \\\"OrderMissing\\\";  \\n  \\n  // prevents infinite an loop by checking to see if the GetOrder\\n  // block has already executed\\n  try {\\n    let lastOrderId = var_get()[\\\"global_custom.accShopify.customerLastOrderId\\\"];\\n    // has the customer placed at least one order?\\n    if (lastOrderId == null || lastOrderId == \\\"\\\") {\\n      // customer hasn't placed any orders\\n      return false;\\n    } else {\\n      // has the order script block already run?\\n      if (var_get()[\\\"GetOrder.value\\\"] == null) {\\n        // no, so order must be missing\\n        return true;\\n      } else {\\n        // order block has already run\\n        return false;\\n      }\\n    }\\n  } catch (error) {\\n    log.debug(\\\"Unexpected error: \\\" + error + \\\" - [flow: \\\" + var_get()[\\\"FlowConfig.name\\\"] + \\\"] - [version: \\\" + var_get()[\\\"FlowConfig.version\\\"] + \\\"] - [block: \\\" + scriptBlockName + \\\"]\\\");\\n    global_var_set(\\\"global_custom.accShopify.errorCode\\\",9000);\\n    global_var_set(\\\"global_custom.accShopify.errorMessage\\\",\\\"Unexpected error: \\\" + error + \\\" - [flow: \\\" + var_get()[\\\"FlowConfig.name\\\"] + \\\"] - [version: \\\" + var_get()[\\\"FlowConfig.version\\\"] + \\\"] - [block: \\\" + scriptBlockName + \\\"]\\\");\\n    return false;\\n  }\\n\\n}\\n\",\"language\":\"javascript\",\"name\":\"OrderMissing\",\"sdkVersion\":2},\"transitions\":[{\"event\":\"Success\",\"friendlyName\":\"Success\",\"next\":\"CheckOrderMissing\",\"id\":\"5484dd38-20c3-4b76-b160-b87785dba240\"},{\"event\":\"Fail\",\"friendlyName\":\"Fail\",\"next\":\"DisplayError\",\"id\":\"92939fda-49cb-465d-b002-422c795b67d7\"}]},{\"id\":\"97c91995-745d-4fc0-a354-5f44f4126ae4\",\"name\":\"CheckOrderMissing\",\"type\":\"Condition\",\"top\":1321.888888888889,\"left\":2580.8888888888887,\"properties\":{\"type\":\"variable\",\"variable\":\"{{OrderMissing.value}}\",\"queueId\":\"\"},\"transitions\":[{\"friendlyName\":\"No Match\",\"event\":\"noMatch\",\"next\":\"MainLogicComplete\",\"id\":\"46247bb4-e654-407f-b68c-e82dcdc1e6db\"},{\"id\":\"9c581116-d3d4-4ed9-b418-894228cc2ccf\",\"event\":\"Match\",\"condition\":null,\"conditionList\":[{\"value\":\"true\",\"operator\":\"Equal to\",\"preOperator\":\"None\"}],\"friendlyName\":\"True\",\"categoryId\":\"\",\"skillId\":\"\",\"skillName\":\"\",\"next\":\"GetOrder\"}]},{\"id\":\"3dcac60d-8efc-4de2-bb7e-c148094cc748\",\"name\":\"CustomerMissing\",\"type\":\"Variable\",\"top\":991,\"left\":1383,\"properties\":{\"script\":\"/*\\n\\nINPUT PARAMETERS FOR DEBUGGING\\n\\n{\\n\\\"GetCustomer.value\\\":\\\"true\\\",\\n\\\"FlowConfig.name\\\":\\\"DebugFlow\\\"\\n}\\n\\n*/\\n\\nasync function main () {\\n  const scriptBlockName = \\\"CustomerMissing\\\";\\n  \\n  // prevents infinite an loop by checking to see if the GetCustomer\\n  // block has already executed\\n  try {\\n    // has the customer script block already run?\\n    if (var_get()[\\\"GetCustomer.value\\\"] == null) {\\n      // no, so customer must be missing\\n      return true;\\n    } else {\\n      // customer block has already run\\n      return false;\\n    }\\n  } catch (error) {\\n    log.debug(\\\"Unexpected error: \\\" + error + \\\" - [flow: \\\" + var_get()[\\\"FlowConfig.name\\\"] + \\\"] - [version: \\\" + var_get()[\\\"FlowConfig.version\\\"] + \\\"] - [block: \\\" + scriptBlockName + \\\"]\\\");\\n    global_var_set(\\\"global_custom.accShopify.errorCode\\\",9000);\\n    global_var_set(\\\"global_custom.accShopify.errorMessage\\\",\\\"Unexpected error: \\\" + error + \\\" - [flow: \\\" + var_get()[\\\"FlowConfig.name\\\"] + \\\"] - [version: \\\" + var_get()[\\\"FlowConfig.version\\\"] + \\\"] - [block: \\\" + scriptBlockName + \\\"]\\\");\\n    return false;\\n  }\\n\\n}\\n\",\"language\":\"javascript\",\"name\":\"CustomerMissing\",\"sdkVersion\":2},\"transitions\":[{\"event\":\"Success\",\"friendlyName\":\"Success\",\"next\":\"CheckCustomerMissing\",\"id\":\"5a0b0b48-39dc-45b1-a329-350536fc0c9e\"},{\"event\":\"Fail\",\"friendlyName\":\"Fail\",\"next\":\"DisplayError\",\"id\":\"daa3d558-eae1-4498-8677-9723db128a9c\"}]},{\"id\":\"e17fe066-2382-49fb-ad51-3623a4bdf4d4\",\"name\":\"CheckCustomerMissing\",\"type\":\"Condition\",\"top\":781.5714285714286,\"left\":949.5714285714286,\"properties\":{\"type\":\"variable\",\"variable\":\"{{CustomerMissing.value}}\",\"queueId\":\"\"},\"transitions\":[{\"friendlyName\":\"No Match\",\"event\":\"noMatch\",\"next\":\"MainLogicComplete\",\"id\":\"f5558277-8916-4a53-84d3-ba19e4dc4ccd\"},{\"id\":\"dc09318e-55d3-4776-bbed-7789644ce5b1\",\"event\":\"Match\",\"condition\":null,\"conditionList\":[{\"value\":\"true\",\"operator\":\"Equal to\",\"preOperator\":\"None\"}],\"friendlyName\":\"True\",\"categoryId\":\"\",\"skillId\":\"\",\"skillName\":\"\",\"next\":\"GetCustomer\"}]},{\"id\":\"1b3b4223-eead-4f5e-bcd5-9bfb6f8aff16\",\"name\":\"CheckProcessOrder\",\"type\":\"Condition\",\"top\":1227,\"left\":1383.5,\"properties\":{\"type\":\"variable\",\"variable\":\"{{ProcessOrder.value}}\",\"queueId\":\"\"},\"transitions\":[{\"friendlyName\":\"No Match\",\"event\":\"noMatch\",\"next\":\"DisplayError\",\"id\":\"4f75f580-8c87-4726-8b12-0692a5b8f84d\"},{\"id\":\"bbbde795-f07d-4ec6-988a-1230f9120d09\",\"event\":\"Match\",\"condition\":null,\"conditionList\":[{\"value\":\"true\",\"operator\":\"Equal to\",\"preOperator\":\"None\"}],\"friendlyName\":\"True\",\"categoryId\":\"\",\"skillId\":\"\",\"skillName\":\"\",\"next\":\"CustomerMissing\"}]},{\"id\":\"45e9af37-5b8e-4f82-8959-2e2872d343c7\",\"name\":\"PreGetSearchMethod\",\"type\":\"CollectInput\",\"top\":7.285714285714292,\"left\":-2876.1428571428573,\"properties\":{\"collectType\":\"quickreply\",\"audioList\":[{\"id\":\"485c3f20-bf9b-4907-ba21-edb7280bdd54\",\"type\":\"speechAudio\",\"voice_id\":\"Joanna\",\"lang\":\"en-US\",\"asset_id\":\"\",\"asset_name\":\"\",\"message\":\"\",\"_publicAsset\":false}],\"videoList\":[],\"cardList\":[{\"id\":\"174aaf56-2d3f-4072-9275-ba55ff97a4aa\",\"asset_id\":\"\",\"text\":\"\"}],\"numberOfDigits\":1,\"finishOnKey\":\"\",\"timeoutInterval\":10,\"enableTimeout\":false,\"promptMediaType\":\"\",\"promptVideoId\":\"\",\"promptVideoName\":\"\",\"_isPublicVideo\":false,\"promptImageId\":\"\",\"promptImageName\":\"\",\"_isPublicImage\":false,\"promptAudioId\":\"\",\"promptAudioName\":\"\",\"enablePromptAudio\":false,\"_isPublicAudio\":false,\"promptText\":{\"ops\":[{\"attributes\":{\"color\":\"rgba(4, 4, 19, 0.56)\"},\"insert\":\"How would you like to search for your customer details?\"},{\"insert\":\"\\n\"}]},\"promtSMSText\":\"How would you like to search for your customer details?\\n\",\"enablePromptText\":true,\"allowInterrupt\":true,\"endingKey\":\"\",\"inputLength\":[1,10],\"quickReplyType\":\"button\",\"textInputLengthMin\":1,\"textInputLengthMax\":10,\"promptSlidesId\":\"\",\"promptSlidesName\":\"\",\"_isPublicPromptSlides\":false,\"enableVideoTimeOut\":true},\"transitions\":[{\"event\":\"timeout\",\"friendlyName\":\"Timeout\",\"next\":null,\"id\":\"34d0140f-0d24-4ef7-a0b2-6ec463a46594\"},{\"id\":\"753a827e-0737-4910-9f20-aafb0069e0c8\",\"event\":\"Match\",\"friendlyName\":\"Email address\",\"categoryId\":\"\",\"skillId\":\"\",\"skillName\":\"\",\"next\":\"PreCollectEmail\"},{\"id\":\"42b027ac-6e64-4347-8895-16035d528148\",\"event\":\"Match\",\"friendlyName\":\"Phone Number\",\"categoryId\":\"\",\"skillId\":\"\",\"skillName\":\"\",\"next\":\"PreCollectPhone\"},{\"id\":\"7b285992-a02d-43fa-a01d-b4678315b48d\",\"event\":\"Match\",\"friendlyName\":\"Order Number\",\"categoryId\":\"\",\"skillId\":\"\",\"skillName\":\"\",\"next\":\"PreCollectOrderNum\"}]},{\"id\":\"cfde08f1-52d8-409b-b67f-085b428a9932\",\"name\":\"FlowConfig\",\"type\":\"Variable\",\"top\":-401,\"left\":-3757,\"properties\":{\"script\":\"/*\\nINPUT PARAMETERS FOR DEBUGGING\\n\\n{\\n\\\"FlowConfig.name\\\":\\\"TestFlow\\\",\\n\\\"FlowConfig.version\\\":\\\"1\\\"\\n}\\n*/\\n\\nasync function main () {\\n  const flowName = \\\"accShopifyWebChat\\\";\\n  const scriptBlockName = \\\"FlowConfig\\\";\\n  const version = \\\"1\\\";\\n  \\n  try {\\n    var_set(\\\"name\\\",flowName);\\n    var_set(\\\"version\\\",version);\\n    \\n    return true;\\n    \\n  } catch (error) {\\n    log.debug(\\\"Unexpected error: \\\" + error + \\\" - [flow: \\\" + flowName + \\\"] - [version: \\\" + version + \\\"] - [block: \\\" + scriptBlockName + \\\"]\\\");\\n    global_var_set(\\\"global_custom.accShopify.errorCode\\\",9000);\\n    global_var_set(\\\"global_custom.accShopify.errorMessage\\\",\\\"Unexpected error: \\\" + error + \\\" - [flow: \\\" + flowName + \\\"] - [version: \\\" + version + \\\"] - [block: \\\" + scriptBlockName + \\\"]\\\");\\n    return false;\\n  }\\n}\\n\",\"language\":\"javascript\",\"name\":\"FlowConfig\",\"sdkVersion\":2},\"transitions\":[{\"event\":\"Success\",\"friendlyName\":\"Success\",\"next\":\"PreResetVariables\",\"id\":\"0b288813-3ab0-4221-87ca-387096bb3a98\"},{\"event\":\"Fail\",\"friendlyName\":\"Fail\",\"next\":null,\"id\":\"b2382895-2c84-4ee3-bdfa-04799ba76646\"}]},{\"id\":\"7d63e3ca-e6e2-4102-aa28-425b9916911c\",\"name\":\"PreResetVariables\",\"type\":\"Variable\",\"top\":-231,\"left\":-2992,\"properties\":{\"script\":\"/*\\nINPUT PARAMETERS FOR DEBUGGING\\n\\n{\\n\\\"FlowConfig.name\\\":\\\"TestFlow\\\",\\n\\\"FlowConfig.version\\\":\\\"1\\\"\\n}\\n*/\\n\\nasync function main () {\\n  const scriptBlockName = \\\"ResetVariables\\\";\\n  \\n  try {\\n    // clear out any previously set error variables\\n    global_var_set(\\\"global_custom.accShopify.errorCode\\\",\\\"\\\");\\n    global_var_set(\\\"global_custom.accShopify.errorMessage\\\",\\\"\\\");\\n    // clear out any previously set custom variables\\n    global_var_set(\\\"global_custom.accShopify.customerEmail\\\",\\\"\\\");\\n    global_var_set(\\\"global_custom.accShopify.customerPhone\\\",\\\"\\\");\\n    global_var_set(\\\"global_custom.accShopify.orderNumber\\\",\\\"\\\");\\n    return true;\\n    \\n  } catch (error) {\\n    log.debug(\\\"Unexpected error: \\\" + error + \\\" - [flow: \\\" + var_get()[\\\"FlowConfig.name\\\"] + \\\"] - [version: \\\" + var_get()[\\\"FlowConfig.version\\\"] + \\\"] - [block: \\\" + scriptBlockName + \\\"]\\\");\\n    global_var_set(\\\"global_custom.accShopify.errorCode\\\",9000);\\n    global_var_set(\\\"global_custom.accShopify.errorMessage\\\",\\\"Unexpected error: \\\" + error + \\\" - [flow: \\\" + var_get()[\\\"FlowConfig.name\\\"] + \\\"] - [version: \\\" + var_get()[\\\"FlowConfig.version\\\"] + \\\"] - [block: \\\" + scriptBlockName + \\\"]\\\");\\n    return false;\\n  }\\n}\\n\",\"language\":\"javascript\",\"name\":\"ResetVariables\",\"sdkVersion\":2},\"transitions\":[{\"event\":\"Success\",\"friendlyName\":\"Success\",\"next\":\"PreGetSearchMethod\",\"id\":\"f7e472e0-9ecf-424c-945d-f5e8754dc7c8\"},{\"event\":\"Fail\",\"friendlyName\":\"Fail\",\"next\":null,\"id\":\"26f7c84c-47bb-45c8-9731-a29c7dedfce7\"}]},{\"id\":\"e30a11fc-fcf0-42e2-876f-dfe7bfb9b636\",\"name\":\"PreCollectEmail\",\"type\":\"CollectInput\",\"top\":-211.28571428571428,\"left\":-2473,\"properties\":{\"collectType\":\"textinput\",\"audioList\":[{\"id\":\"1dffb194-affb-4917-acc8-e2e91984f7d0\",\"type\":\"speechAudio\",\"voice_id\":\"Joanna\",\"lang\":\"en-US\",\"asset_id\":\"\",\"asset_name\":\"\",\"message\":\"\",\"_publicAsset\":false}],\"videoList\":[],\"cardList\":[{\"id\":\"6e10629e-e419-4184-b5a3-181c38b96818\",\"asset_id\":\"\",\"text\":\"\"}],\"numberOfDigits\":1,\"finishOnKey\":\"\",\"timeoutInterval\":10,\"enableTimeout\":false,\"promptMediaType\":\"\",\"promptVideoId\":\"\",\"promptVideoName\":\"\",\"_isPublicVideo\":false,\"promptImageId\":\"\",\"promptImageName\":\"\",\"_isPublicImage\":false,\"promptAudioId\":\"\",\"promptAudioName\":\"\",\"enablePromptAudio\":false,\"_isPublicAudio\":false,\"promptText\":{\"ops\":[{\"attributes\":{\"color\":\"rgba(4, 4, 19, 0.56)\"},\"insert\":\"Please enter your email address\"},{\"insert\":\"\\n\"}]},\"promtSMSText\":\"Please enter your email address\\n\",\"enablePromptText\":true,\"allowInterrupt\":true,\"endingKey\":\"\",\"inputLength\":[1,10],\"quickReplyType\":\"button\",\"textInputLengthMin\":1,\"textInputLengthMax\":10,\"promptSlidesId\":\"\",\"promptSlidesName\":\"\",\"_isPublicPromptSlides\":false,\"enableVideoTimeOut\":true},\"transitions\":[{\"event\":\"endOfInput\",\"friendlyName\":\"End of Input\",\"next\":\"PreSearchByEmail\",\"id\":\"f1b68dbe-37e8-4e78-889f-1089e89fe65c\"},{\"event\":\"timeout\",\"friendlyName\":\"Timeout\",\"next\":\"PreTimeoutMessage\",\"id\":\"72f32eb3-dff0-4012-8c64-0413307867b1\"}]},{\"id\":\"275ba7d2-62f1-48a4-bbab-1fc0bb9989d3\",\"name\":\"PreCollectPhone\",\"type\":\"CollectInput\",\"top\":-44,\"left\":-2473.3333333333335,\"properties\":{\"collectType\":\"textinput\",\"audioList\":[{\"id\":\"1dffb194-affb-4917-acc8-e2e91984f7d0\",\"type\":\"speechAudio\",\"voice_id\":\"Joanna\",\"lang\":\"en-US\",\"asset_id\":\"\",\"asset_name\":\"\",\"message\":\"\",\"_publicAsset\":false}],\"videoList\":[],\"cardList\":[{\"id\":\"6e10629e-e419-4184-b5a3-181c38b96818\",\"asset_id\":\"\",\"text\":\"\"}],\"numberOfDigits\":1,\"finishOnKey\":\"\",\"timeoutInterval\":10,\"enableTimeout\":false,\"promptMediaType\":\"\",\"promptVideoId\":\"\",\"promptVideoName\":\"\",\"_isPublicVideo\":false,\"promptImageId\":\"\",\"promptImageName\":\"\",\"_isPublicImage\":false,\"promptAudioId\":\"\",\"promptAudioName\":\"\",\"enablePromptAudio\":false,\"_isPublicAudio\":false,\"promptText\":{\"ops\":[{\"attributes\":{\"color\":\"rgba(4, 4, 19, 0.56)\"},\"insert\":\"Please enter your phone number\"},{\"insert\":\"\\n\"}]},\"promtSMSText\":\"Please enter your phone number\\n\",\"enablePromptText\":true,\"allowInterrupt\":true,\"endingKey\":\"\",\"inputLength\":[1,10],\"quickReplyType\":\"button\",\"textInputLengthMin\":1,\"textInputLengthMax\":10,\"promptSlidesId\":\"\",\"promptSlidesName\":\"\",\"_isPublicPromptSlides\":false,\"enableVideoTimeOut\":true},\"transitions\":[{\"event\":\"endOfInput\",\"friendlyName\":\"End of Input\",\"next\":\"PreSearchByPhone\",\"id\":\"3e4c3acb-83cc-402d-aff1-997e87fd9a00\"},{\"event\":\"timeout\",\"friendlyName\":\"Timeout\",\"next\":\"PreTimeoutMessage\",\"id\":\"9d02b111-7995-4b40-a8c1-e4adf14066a5\"}]},{\"id\":\"46c69ed9-885d-4135-9e5f-954997ba101a\",\"name\":\"PreCollectOrderNum\",\"type\":\"CollectInput\",\"top\":134.57142857142856,\"left\":-2474.4285714285716,\"properties\":{\"collectType\":\"textinput\",\"audioList\":[{\"id\":\"1dffb194-affb-4917-acc8-e2e91984f7d0\",\"type\":\"speechAudio\",\"voice_id\":\"Joanna\",\"lang\":\"en-US\",\"asset_id\":\"\",\"asset_name\":\"\",\"message\":\"\",\"_publicAsset\":false}],\"videoList\":[],\"cardList\":[{\"id\":\"6e10629e-e419-4184-b5a3-181c38b96818\",\"asset_id\":\"\",\"text\":\"\"}],\"numberOfDigits\":1,\"finishOnKey\":\"\",\"timeoutInterval\":10,\"enableTimeout\":false,\"promptMediaType\":\"\",\"promptVideoId\":\"\",\"promptVideoName\":\"\",\"_isPublicVideo\":false,\"promptImageId\":\"\",\"promptImageName\":\"\",\"_isPublicImage\":false,\"promptAudioId\":\"\",\"promptAudioName\":\"\",\"enablePromptAudio\":false,\"_isPublicAudio\":false,\"promptText\":{\"ops\":[{\"attributes\":{\"color\":\"rgba(4, 4, 19, 0.56)\"},\"insert\":\"Please enter your order number\"},{\"insert\":\"\\n\"}]},\"promtSMSText\":\"Please enter your order number\\n\",\"enablePromptText\":true,\"allowInterrupt\":true,\"endingKey\":\"\",\"inputLength\":[1,10],\"quickReplyType\":\"button\",\"textInputLengthMin\":1,\"textInputLengthMax\":10,\"promptSlidesId\":\"\",\"promptSlidesName\":\"\",\"_isPublicPromptSlides\":false,\"enableVideoTimeOut\":true},\"transitions\":[{\"event\":\"endOfInput\",\"friendlyName\":\"End of Input\",\"next\":\"PreSearchByOrderNum\",\"id\":\"abaa8d9b-cff8-4299-8570-96473ecbad49\"},{\"event\":\"timeout\",\"friendlyName\":\"Timeout\",\"next\":\"PreTimeoutMessage\",\"id\":\"44cc7b07-d66c-40e5-869b-5342b1c2dcd7\"}]},{\"id\":\"bd028d00-aead-429c-8625-d97de99ad4d1\",\"name\":\"PreSearchByEmail\",\"type\":\"SetVariables\",\"top\":-201.14285714285714,\"left\":-1989.5714285714287,\"properties\":{\"variables\":[{\"id\":\"7a0b524e-f215-4f14-b686-6ebbb8850de7\",\"target\":\"{{global_custom.accShopify.searchMethod}}\",\"source\":\"customerByEmail\",\"mode\":\"fromValue\",\"targetId\":\"f45d4072-367b-4ba2-a8b7-f4be1f490678\",\"targetDataType\":\"String\",\"sourceId\":\"\"}]},\"transitions\":[{\"event\":\"next\",\"next\":\"PreSetVariables\",\"id\":\"2b5fadb8-01f5-41ac-8c9e-05270bcf038e\"}]},{\"id\":\"db484bec-d61c-48c4-8d59-70590fbd64b0\",\"name\":\"PreSearchByPhone\",\"type\":\"SetVariables\",\"top\":2,\"left\":-1991,\"properties\":{\"variables\":[{\"id\":\"7a0b524e-f215-4f14-b686-6ebbb8850de7\",\"target\":\"{{global_custom.accShopify.searchMethod}}\",\"source\":\"customerByPhone\",\"mode\":\"fromValue\",\"targetId\":\"f45d4072-367b-4ba2-a8b7-f4be1f490678\",\"targetDataType\":\"String\",\"sourceId\":\"\"}]},\"transitions\":[{\"event\":\"next\",\"next\":\"PreSetVariables\",\"id\":\"5bd5fe7c-e3d7-4bbf-8f32-988fd9972b08\"}]},{\"id\":\"13f9ad06-cb57-4208-a878-d3a339cf75ac\",\"name\":\"PreSearchByOrderNum\",\"type\":\"SetVariables\",\"top\":193.22222222222223,\"left\":-1990.7777777777778,\"properties\":{\"variables\":[{\"id\":\"7a0b524e-f215-4f14-b686-6ebbb8850de7\",\"target\":\"{{global_custom.accShopify.searchMethod}}\",\"source\":\"orderByNumber\",\"mode\":\"fromValue\",\"targetId\":\"f45d4072-367b-4ba2-a8b7-f4be1f490678\",\"targetDataType\":\"String\",\"sourceId\":\"\"}]},\"transitions\":[{\"event\":\"next\",\"next\":\"PreSetVariables\",\"id\":\"0193c152-7774-4042-bdc1-bfa4cb53156c\"}]},{\"id\":\"6d400650-c2bb-4387-a740-d700a766e2d3\",\"name\":\"PreSetVariables\",\"type\":\"Variable\",\"top\":294,\"left\":-1339,\"properties\":{\"script\":\"/*\\nINPUT PARAMETERS FOR DEBUGGING\\n\\n{\\n\\\"CollectEmail.TextInput\\\":\\\"xxx@yyy.com\\\",\\n\\\"global_custom.accShopify.customerEmail\\\":\\\"xxx@yyy.com\\\"\\n}\\n\\n*/\\n\\nasync function main () {\\n  const scriptBlockName = \\\"SetVariables\\\";\\n\\n  try {\\n    let email = var_get()[\\\"CollectEmail.TextInput\\\"];\\n    let phone = var_get()[\\\"CollectPhone.TextInput\\\"];\\n    let orderNumber = var_get()[\\\"CollectOrderNumber.TextInput\\\"];\\n    \\n    \\n    // log.debug(\\\"email: \\\" + email);\\n    if (email != null){\\n      global_var_set(\\\"global_custom.accShopify.customerEmail\\\", email);\\n      if (!isValidEmailAddress(email)) {\\n        global_var_set(\\\"global_custom.accShopify.errorCode\\\",1004);\\n        global_var_set(\\\"global_custom.accShopify.errorMessage\\\",\\\"Supplied email address not valid\\\" + \\\" - [flow: \\\" + var_get()[\\\"FlowConfig.name\\\"] + \\\"] - [version: \\\" + var_get()[\\\"FlowConfig.version\\\"] + \\\"] - [block: \\\" + scriptBlockName + \\\"]\\\");\\n        return false;\\n      }\\n    }\\n    \\n    // log.debug(\\\"phone: \\\" + phone);\\n    if (phone != null){\\n      phone = enforcePhoneNumberPattern(phone);\\n      global_var_set(\\\"global_custom.accShopify.customerPhone\\\", phone);\\n      if (phone.length == 0 || var_get()[\\\"global_custom.accShopify.customerPhone\\\"] == null) {\\n        global_var_set(\\\"global_custom.accShopify.errorCode\\\",1005);\\n        global_var_set(\\\"global_custom.accShopify.errorMessage\\\",\\\"Supplied phone number not valid\\\" + \\\" - [flow: \\\" + var_get()[\\\"FlowConfig.name\\\"] + \\\"] - [version: \\\" + var_get()[\\\"FlowConfig.version\\\"] + \\\"] - [block: \\\" + scriptBlockName + \\\"]\\\");\\n        return false;\\n      }\\n    }\\n    \\n    // log.debug(\\\"orderNumber: \\\" + var_get()[\\\"CollectOrderNumber.TextInput\\\"]);\\n    if (orderNumber != null){\\n      global_var_set(\\\"global_custom.accShopify.orderNumber\\\", orderNumber);\\n    }\\n       \\n    return true;\\n    \\n  } catch (error) {    \\n    log.debug(\\\"Unexpected error: \\\" + error + \\\" - [flow: \\\" + var_get()[\\\"FlowConfig.name\\\"] + \\\"] - [version: \\\" + var_get()[\\\"FlowConfig.version\\\"] + \\\"] - [block: \\\" + scriptBlockName + \\\"]\\\");\\n    global_var_set(\\\"global_custom.accShopify.errorCode\\\",9000);\\n    global_var_set(\\\"global_custom.accShopify.errorMessage\\\",\\\"Unexpected error: \\\" + error + \\\" - [flow: \\\" + var_get()[\\\"FlowConfig.name\\\"] + \\\"] - [version: \\\" + var_get()[\\\"FlowConfig.version\\\"] + \\\"] - [block: \\\" + scriptBlockName + \\\"]\\\");\\n    return false;\\n  }\\n}\\n\\n// basic regex check for valid email address\\nfunction isValidEmailAddress(valueToCheck){\\n  \\n  if (/[a-zA-Z0-9_.]+@[a-zA-Z0-9]+\\\\.[a-zA-Z]{2,3}/.test(valueToCheck)) {\\n    return true;\\n  } else {\\n    return false;\\n  }\\n}\\n\\n// rudimentary function to format a phone number to E164\\nfunction enforcePhoneNumberPattern(stringNumber) {\\n  let newString = stringNumber.match(/[0-9]{0,14}/g);\\n  let defaultCountryPrefix = '44';  // UK country code\\n  if (newString === null) {\\n    return '';\\n  }\\n  newString = newString.join('');  \\n  // defaults numbers to UK if not already specified\\n  // if (!newString.startsWith(\\\"44\\\")){\\n    if (newString.startsWith(\\\"0\\\")){\\n      newString = newString.substring(1, 15);\\n      newString = defaultCountryPrefix + newString;\\n    }\\n  // }\\n  // Limit length to 15 characters\\n  newString = newString.substring(0, 15);\\n  return newString;\\n}\\n\",\"language\":\"javascript\",\"name\":\"SetVariables\",\"sdkVersion\":2},\"transitions\":[{\"event\":\"Success\",\"friendlyName\":\"Success\",\"next\":\"PreCheckSetVariables\",\"id\":\"c9aeab99-6d42-4206-a3a0-1aa6641c7517\"},{\"event\":\"Fail\",\"friendlyName\":\"Fail\",\"next\":null,\"id\":\"984a5831-eec9-418c-bdd7-743624a58ff9\"}]},{\"id\":\"f18e5160-7094-43ec-9481-9ab7f59d8058\",\"name\":\"PreTimeoutMessage\",\"type\":\"SendMedia\",\"top\":512,\"left\":-2100.714285714286,\"properties\":{\"media_type\":\"textimage\",\"promptAudioId\":\"\",\"promptAudioName\":\"\",\"enablePromptAudio\":false,\"allowInterrupt\":true,\"_isPublicPromptAudio\":false,\"audioList\":[{\"id\":\"566473c7-f475-415c-a492-89775bbd695b\",\"type\":\"speechAudio\",\"voice_id\":\"Joanna\",\"lang\":\"en-US\",\"asset_id\":\"\",\"asset_name\":\"\",\"message\":\"\",\"_publicAsset\":false}],\"videoList\":[{\"id\":\"5e6cbb5a-c2fb-49e0-a9e6-20a86f8409e1\",\"type\":\"assetVideo\",\"asset_id\":\"\",\"asset_name\":\"\",\"_publicAsset\":false,\"text\":\"\",\"enableText\":true,\"enableImage\":false}],\"chatList\":[{\"id\":\"964f8446-cb81-4d8a-af43-cd7e14ec70e4\",\"type\":\"assetImage\",\"asset_id\":\"\",\"asset_name\":\"\",\"text\":{\"ops\":[{\"attributes\":{\"color\":\"rgba(4, 4, 19, 0.56)\"},\"insert\":\"Sorry, that took too long.  Please try again.\"},{\"insert\":\"\\n\"}]},\"audio_id\":\"\",\"enableText\":true,\"enableImage\":false,\"enableAudio\":false,\"audio_name\":\"\",\"_publicAudio\":false,\"SMSText\":\"Sorry, that took too long.  Please try again.\\n\"}],\"slidesList\":[{\"id\":\"eb708ff1-7001-479f-a715-e5f2cebf4d88\",\"type\":\"assetSlides\",\"asset_id\":\"\",\"asset_name\":\"\",\"_publicAsset\":false}],\"cardList\":[{\"id\":\"3697eb29-5f8a-46a8-add2-60a3c7103d8e\",\"asset_id\":\"\",\"text\":\"\"}]},\"transitions\":[{\"event\":\"next\",\"next\":\"PreGetSearchMethod\",\"id\":\"dbbcd81b-03c9-4939-892f-377f302c8ec6\",\"friendlyName\":\"Next Step\"},{\"event\":\"sendMediaFailed\",\"friendlyName\":\"Send Media Failed\",\"_tooltip\":\"Media failed to send to the end customer\",\"next\":null,\"id\":\"987f67a2-4beb-40c3-b338-cc99411b50a5\"}]},{\"id\":\"e39f7cf2-1da0-495c-9158-b2f789d59dfb\",\"name\":\"PreCheckSetVariables\",\"type\":\"Condition\",\"top\":137,\"left\":-925.5714285714286,\"properties\":{\"type\":\"variable\",\"variable\":\"{{PreSetVariables.value}}\",\"queueId\":\"\"},\"transitions\":[{\"friendlyName\":\"No Match\",\"event\":\"noMatch\",\"next\":\"PreDisplayError\",\"id\":\"b9d8a53b-6a5f-40a2-95ff-a14d62dd825c\"},{\"id\":\"13beb9c2-e805-47a6-a922-f23b78ff2877\",\"event\":\"Match\",\"condition\":null,\"conditionList\":[{\"value\":\"true\",\"operator\":\"Equal to\",\"preOperator\":\"None\"}],\"friendlyName\":\"True\",\"categoryId\":\"\",\"skillId\":\"\",\"skillName\":\"\",\"next\":\"ValidateSetup\"}]},{\"id\":\"bbaa04e0-1f32-4ec7-ad5c-4d005399a1be\",\"name\":\"PreDisplayError\",\"type\":\"SendMedia\",\"top\":-76.71428571428571,\"left\":-1371,\"properties\":{\"media_type\":\"textimage\",\"promptAudioId\":\"\",\"promptAudioName\":\"\",\"enablePromptAudio\":false,\"allowInterrupt\":true,\"_isPublicPromptAudio\":false,\"audioList\":[{\"id\":\"116c2a05-20e7-43d7-ad35-7e7dc0b05fab\",\"type\":\"speechAudio\",\"voice_id\":\"Joanna\",\"lang\":\"en-US\",\"asset_id\":\"\",\"asset_name\":\"\",\"message\":\"\",\"_publicAsset\":false}],\"videoList\":[{\"id\":\"cff19b18-33e0-483e-b229-2171916a5346\",\"type\":\"assetVideo\",\"asset_id\":\"\",\"asset_name\":\"\",\"_publicAsset\":false,\"text\":\"\",\"enableText\":true,\"enableImage\":false}],\"chatList\":[{\"id\":\"6620bfd2-8758-4cfc-81d7-e3f10a6102ef\",\"type\":\"assetImage\",\"asset_id\":\"\",\"asset_name\":\"\",\"text\":{\"ops\":[{\"insert\":\"Oooops!  Something went wrong...\\nError code: {{global_custom.accShopify.errorCode}};\\nError message: {{global_custom.accShopify.errorMessage}}\\n\"}]},\"audio_id\":\"\",\"enableText\":true,\"enableImage\":false,\"enableAudio\":false,\"audio_name\":\"\",\"_publicAudio\":false,\"SMSText\":\"Oooops!  Something went wrong...\\nError code: {{global_custom.accShopify.errorCode}};\\nError message: {{global_custom.accShopify.errorMessage}}\\n\"}],\"slidesList\":[{\"id\":\"30682791-9c4b-4225-aaf3-871e51f7bf86\",\"type\":\"assetSlides\",\"asset_id\":\"\",\"asset_name\":\"\",\"_publicAsset\":false}],\"cardList\":[{\"id\":\"823710ca-dbdf-4bf6-a89f-f9e01f2ee4d6\",\"asset_id\":\"\",\"text\":\"\"}]},\"transitions\":[{\"event\":\"next\",\"next\":\"PreTryAgain\",\"id\":\"c3f2c539-6ad6-4710-b6a7-57d55f862a18\",\"friendlyName\":\"Next Step\"},{\"event\":\"sendMediaFailed\",\"friendlyName\":\"Send Media Failed\",\"_tooltip\":\"Media failed to send to the end customer\",\"next\":null,\"id\":\"b17b2658-93f9-4c19-912f-9a1863f6a175\"}]},{\"id\":\"bbab279e-30d0-4327-ab8b-bdacf4edab0e\",\"name\":\"PreTryAgain\",\"type\":\"CollectInput\",\"top\":-500.57142857142856,\"left\":-956,\"properties\":{\"collectType\":\"quickreply\",\"audioList\":[{\"id\":\"1df78884-e539-4835-a8dd-933740fd9d33\",\"type\":\"speechAudio\",\"voice_id\":\"Joanna\",\"lang\":\"en-US\",\"asset_id\":\"\",\"asset_name\":\"\",\"message\":\"\",\"_publicAsset\":false}],\"videoList\":[],\"cardList\":[{\"id\":\"a1fff53b-afe4-462d-b20e-0d06f5985f3d\",\"asset_id\":\"\",\"text\":\"\"}],\"numberOfDigits\":1,\"finishOnKey\":\"\",\"timeoutInterval\":10,\"enableTimeout\":false,\"promptMediaType\":\"\",\"promptVideoId\":\"\",\"promptVideoName\":\"\",\"_isPublicVideo\":false,\"promptImageId\":\"\",\"promptImageName\":\"\",\"_isPublicImage\":false,\"promptAudioId\":\"\",\"promptAudioName\":\"\",\"enablePromptAudio\":false,\"_isPublicAudio\":false,\"promptText\":{\"ops\":[{\"attributes\":{\"color\":\"rgba(4, 4, 19, 0.56)\"},\"insert\":\"Would you like to try again?\"},{\"insert\":\"\\n\"}]},\"promtSMSText\":\"Would you like to try again?\\n\",\"enablePromptText\":true,\"allowInterrupt\":true,\"endingKey\":\"\",\"inputLength\":[1,10],\"quickReplyType\":\"button\",\"textInputLengthMin\":1,\"textInputLengthMax\":10,\"promptSlidesId\":\"\",\"promptSlidesName\":\"\",\"_isPublicPromptSlides\":false,\"enableVideoTimeOut\":true},\"transitions\":[{\"event\":\"timeout\",\"friendlyName\":\"Timeout\",\"next\":null,\"id\":\"1afcaad5-cbe6-4b82-bc92-47c6dded02f1\"},{\"id\":\"3760a25c-f6ff-4a84-b1bc-579f8caf8138\",\"event\":\"Match\",\"friendlyName\":\"Yes\",\"categoryId\":\"\",\"skillId\":\"\",\"skillName\":\"\",\"next\":\"PreResetVariables\"},{\"id\":\"bbbc3feb-63a9-4868-8d46-586dd1e2ec17\",\"event\":\"Match\",\"friendlyName\":\"No thanks\",\"categoryId\":\"\",\"skillId\":\"\",\"skillName\":\"\",\"next\":null}]},{\"id\":\"993e9561-64f2-4cc4-ab4f-76b19fb67d68\",\"name\":\"DisplayError\",\"type\":\"SendMedia\",\"top\":105,\"left\":2526.4285714285716,\"properties\":{\"media_type\":\"textimage\",\"promptAudioId\":\"\",\"promptAudioName\":\"\",\"enablePromptAudio\":false,\"allowInterrupt\":true,\"_isPublicPromptAudio\":false,\"audioList\":[{\"id\":\"a5790c2d-bba4-4374-bde8-d6c10428b6f4\",\"type\":\"speechAudio\",\"voice_id\":\"Joanna\",\"lang\":\"en-US\",\"asset_id\":\"\",\"asset_name\":\"\",\"message\":\"\",\"_publicAsset\":false}],\"videoList\":[{\"id\":\"05984c62-a76c-4917-a26f-6aa9fc648b0b\",\"type\":\"assetVideo\",\"asset_id\":\"\",\"asset_name\":\"\",\"_publicAsset\":false,\"text\":\"\",\"enableText\":true,\"enableImage\":false}],\"chatList\":[{\"id\":\"ff750310-9321-404b-a741-becc198fd9bc\",\"type\":\"assetImage\",\"asset_id\":\"\",\"asset_name\":\"\",\"text\":{\"ops\":[{\"insert\":\"Oooops!  Something went wrong...\\nError code: {{global_custom.accShopify.errorCode}};\\nError message: {{global_custom.accShopify.errorMessage}}\\n\"}]},\"audio_id\":\"\",\"enableText\":true,\"enableImage\":false,\"enableAudio\":false,\"audio_name\":\"\",\"_publicAudio\":false,\"SMSText\":\"Oooops!  Something went wrong...\\nError code: {{global_custom.accShopify.errorCode}};\\nError message: {{global_custom.accShopify.errorMessage}}\\n\"}],\"slidesList\":[{\"id\":\"9d80aba5-47de-4cde-a54d-7fb90ed5744f\",\"type\":\"assetSlides\",\"asset_id\":\"\",\"asset_name\":\"\",\"_publicAsset\":false}],\"cardList\":[{\"id\":\"a79f81fa-c60e-4334-a64b-5574b6f71bc9\",\"asset_id\":\"\",\"text\":\"\"}]},\"transitions\":[{\"event\":\"next\",\"next\":null,\"id\":\"8c1e656d-1c83-483d-a917-e91e3d578d67\",\"friendlyName\":\"Next Step\"},{\"event\":\"sendMediaFailed\",\"friendlyName\":\"Send Media Failed\",\"_tooltip\":\"Media failed to send to the end customer\",\"next\":null,\"id\":\"c5c4ce2c-7a72-4fbe-9e72-062677459b26\"}]},{\"id\":\"0f970d42-2f2f-4527-bbf9-1f1868c89378\",\"name\":\"PostSetCustomerData\",\"type\":\"Variable\",\"top\":1141,\"left\":3790,\"properties\":{\"script\":\"/*\\nINPUT PARAMETERS FOR DEBUGGING\\n\\n{\\n\\\"FlowConfig.Name\\\":\\\"DebugFlow\\\"\\n}\\n\\n*/\\n\\nasync function main () {\\n  const scriptBlockName = \\\"OrderExists\\\";\\n  try { \\n    let customerPhone = (var_get()[\\\"global_custom.accShopify.customerPhone\\\"] != null) ? var_get()[\\\"global_custom.accShopify.customerPhone\\\"] : \\\"null\\\";\\n    let customerLastOrderId = (var_get()[\\\"global_custom.accShopify.customerLastOrderId\\\"] != null) ? var_get()[\\\"global_custom.accShopify.customerLastOrderId\\\"] : \\\"null\\\";\\n    let customerNote = (var_get()[\\\"global_custom.accShopify.customerNote\\\"] != null) ? var_get()[\\\"global_custom.accShopify.customerNote\\\"] : \\\"null\\\";\\n\\tlet customerState = (var_get()[\\\"global_custom.accShopify.customerState\\\"] != null) ? var_get()[\\\"global_custom.accShopify.customerState\\\"] : \\\"null\\\";\\n    let customerTags = (var_get()[\\\"global_custom.accShopify.customerTags\\\"] != null) ? var_get()[\\\"global_custom.accShopify.customerTags\\\"] : \\\"null\\\";\\n    \\n    // use local variables for any nullable values - this prevents issues when displaying in the SendMedia block\\n    var_set(\\\"customerPhone\\\", \\\"customerPhone: \\\" + customerPhone);\\n    var_set(\\\"customerLastOrderId\\\", \\\"customerLastOrderId: \\\" + customerLastOrderId);\\n    var_set(\\\"customerNote\\\", \\\"customerNote: \\\" + customerNote);\\n    var_set(\\\"customerState\\\", \\\"customerState: \\\" + customerState);\\n    var_set(\\\"customerTags\\\", \\\"customerTags: \\\" + customerTags);\\n    return true;\\n    \\n  } catch (error) {\\n    log.debug(\\\"Unexpected error: \\\" + error + \\\" - [flow: \\\" + var_get()[\\\"FlowConfig.name\\\"] + \\\"] - [version: \\\" + var_get()[\\\"FlowConfig.version\\\"] + \\\"] - [block: \\\" + scriptBlockName + \\\"]\\\");\\n    global_var_set(\\\"global_custom.accShopify.errorCode\\\",9000);\\n    global_var_set(\\\"global_custom.accShopify.errorMessage\\\",\\\"Unexpected error: \\\" + error + \\\" - [flow: \\\" + var_get()[\\\"FlowConfig.name\\\"] + \\\"] - [version: \\\" + var_get()[\\\"FlowConfig.version\\\"] + \\\"] - [block: \\\" + scriptBlockName + \\\"]\\\");\\n    return false;\\n  }\\n}\",\"language\":\"javascript\",\"name\":\"PostSetCustomerData\",\"sdkVersion\":2},\"transitions\":[{\"event\":\"Success\",\"friendlyName\":\"Success\",\"next\":\"PostDisplayCustomer\",\"id\":\"fa083b35-0ecb-4aec-82c7-2e3237d2b187\"},{\"event\":\"Fail\",\"friendlyName\":\"Fail\",\"next\":\"PostDisplayError\",\"id\":\"177b07af-c2ed-4f5f-9a3d-1708f50ac1df\"}]},{\"id\":\"0ec33d7c-b77d-45ba-ba7d-44eccaf7fe18\",\"name\":\"MainLogicComplete\",\"type\":\"Variable\",\"top\":1150,\"left\":2958,\"properties\":{\"script\":\"/*\\n-------------------------------------------------------------------------------\\nPLEASE NOTE\\n-------------------------------------------------------------------------------\\nThis script returns true and contains no logic.\\nIt acts as a single place to mark the end of the data retrieval blocks before \\nthe post-execution blocks aare called.\\n\\nWhen modifying your flow to include your own post-execution logic, update\\nthe exit point of this block to link to the block where your own logic starts.\\n-------------------------------------------------------------------------------\\n*/\\n\\nasync function main () {\\n  return true;\\n}\\n\",\"language\":\"javascript\",\"name\":\"DataLogicComplete\",\"sdkVersion\":2},\"transitions\":[{\"event\":\"Success\",\"friendlyName\":\"Success\",\"next\":\"PostSetCustomerData\",\"id\":\"d0fd6196-8fbf-46eb-97bc-d35608a95555\"},{\"event\":\"Fail\",\"friendlyName\":\"Fail\",\"next\":\"PostSetCustomerData\",\"id\":\"db519b2f-cd00-416d-b462-f871f4fb02b6\"}]},{\"id\":\"2e25e599-f0a6-420f-b280-93553e3456cf\",\"name\":\"PostDisplayError\",\"type\":\"SendMedia\",\"top\":1860.7142857142858,\"left\":4128.285714285715,\"properties\":{\"media_type\":\"textimage\",\"promptAudioId\":\"\",\"promptAudioName\":\"\",\"enablePromptAudio\":false,\"allowInterrupt\":true,\"_isPublicPromptAudio\":false,\"audioList\":[{\"id\":\"4dd29b83-53be-4f7b-93bc-6f340d01cdd6\",\"type\":\"speechAudio\",\"voice_id\":\"Joanna\",\"lang\":\"en-US\",\"asset_id\":\"\",\"asset_name\":\"\",\"message\":\"\",\"_publicAsset\":false}],\"videoList\":[{\"id\":\"311ebe57-2f15-4ab0-911e-adfc754f50cd\",\"type\":\"assetVideo\",\"asset_id\":\"\",\"asset_name\":\"\",\"_publicAsset\":false,\"text\":\"\",\"enableText\":true,\"enableImage\":false}],\"chatList\":[{\"id\":\"4343066b-69bd-47e2-b3be-e54db7606046\",\"type\":\"assetImage\",\"asset_id\":\"\",\"asset_name\":\"\",\"text\":{\"ops\":[{\"insert\":\"Oooops!  Something went wrong...\\nError code: {{global_custom.accShopify.errorCode}};\\nError message: {{global_custom.accShopify.errorMessage}}\\n\"}]},\"audio_id\":\"\",\"enableText\":true,\"enableImage\":false,\"enableAudio\":false,\"audio_name\":\"\",\"_publicAudio\":false,\"SMSText\":\"Oooops!  Something went wrong...\\nError code: {{global_custom.accShopify.errorCode}};\\nError message: {{global_custom.accShopify.errorMessage}}\\n\"}],\"slidesList\":[{\"id\":\"ef2e7ba4-661d-4b10-9819-099d2b3630d5\",\"type\":\"assetSlides\",\"asset_id\":\"\",\"asset_name\":\"\",\"_publicAsset\":false}],\"cardList\":[{\"id\":\"a4d134ae-9af3-486c-8f0a-4db9bb67f989\",\"asset_id\":\"\",\"text\":\"\"}]},\"transitions\":[{\"event\":\"next\",\"next\":null,\"id\":\"daa59835-3aad-4730-956f-a2f29efcd9d2\",\"friendlyName\":\"Next Step\"},{\"event\":\"sendMediaFailed\",\"friendlyName\":\"Send Media Failed\",\"_tooltip\":\"Media failed to send to the end customer\",\"next\":null,\"id\":\"7edbc7f7-b81e-457b-b8fa-6087fb0e9f17\"}]},{\"id\":\"69a9a932-4808-44ef-bb5f-871f9885632b\",\"name\":\"PostDisplayCustomer\",\"type\":\"SendMedia\",\"top\":1209,\"left\":4300,\"properties\":{\"media_type\":\"textimage\",\"promptAudioId\":\"\",\"promptAudioName\":\"\",\"enablePromptAudio\":false,\"allowInterrupt\":true,\"_isPublicPromptAudio\":false,\"audioList\":[{\"id\":\"bc4c4997-630a-4db9-ac9f-5d31da18f592\",\"type\":\"speechAudio\",\"voice_id\":\"Joanna\",\"lang\":\"en-US\",\"asset_id\":\"\",\"asset_name\":\"\",\"message\":\"\",\"_publicAsset\":false}],\"videoList\":[{\"id\":\"989015e3-8888-4def-8b46-b47b7354400c\",\"type\":\"assetVideo\",\"asset_id\":\"\",\"asset_name\":\"\",\"_publicAsset\":false,\"text\":\"\",\"enableText\":true,\"enableImage\":false}],\"chatList\":[{\"id\":\"9d4012c2-d465-464d-899d-cb80cf17e9df\",\"type\":\"assetImage\",\"asset_id\":\"\",\"asset_name\":\"\",\"text\":{\"ops\":[{\"attributes\":{\"color\":\"rgba(4, 4, 19, 0.56)\"},\"insert\":\"The following customer variables have been set within the accShopify group:\"},{\"insert\":\"\\n\"}]},\"audio_id\":\"\",\"enableText\":true,\"enableImage\":false,\"enableAudio\":false,\"audio_name\":\"\",\"_publicAudio\":false,\"SMSText\":\"The following customer variables have been set within the accShopify group:\\n\"},{\"id\":\"3cd81dbd-ea2d-4e1b-9c1a-2660b3907a21\",\"type\":\"assetImage\",\"asset_id\":\"\",\"asset_name\":\"\",\"text\":{\"ops\":[{\"insert\":\"customerId: {{global_custom.accShopify.customerId}}\\ncustomerEmail: {{global_custom.accShopify.customerEmail}}\\ncustomerFirstName: {{global_custom.accShopify.customerFirstName}}\\ncustomerLastName: {{global_custom.accShopify.customerLastName}}\\n{{PostSetCustomerData.customerPhone}}\\ncustomerOrdersCount: {{global_custom.accShopify.customerOrdersCount}}\\n{{PostSetCustomerData.customerLastOrderId}}\\n{{PostSetCustomerData.customerNote}}\\n{{PostSetCustomerData.customerState}}\\n{{PostSetCustomerData.customerTags}}\\ncustomerTotalSpent: {{global_custom.accShopify.customerTotalSpent}}\\n\"}]},\"SMSText\":\"customerId: {{global_custom.accShopify.customerId}}\\ncustomerEmail: {{global_custom.accShopify.customerEmail}}\\ncustomerFirstName: {{global_custom.accShopify.customerFirstName}}\\ncustomerLastName: {{global_custom.accShopify.customerLastName}}\\n{{PostSetCustomerData.customerPhone}}\\ncustomerOrdersCount: {{global_custom.accShopify.customerOrdersCount}}\\n{{PostSetCustomerData.customerLastOrderId}}\\n{{PostSetCustomerData.customerNote}}\\n{{PostSetCustomerData.customerState}}\\n{{PostSetCustomerData.customerTags}}\\ncustomerTotalSpent: {{global_custom.accShopify.customerTotalSpent}}\\n\",\"enableText\":true,\"enableImage\":false,\"enableAudio\":false,\"audio_id\":\"\",\"audio_name\":\"\",\"_publicAudio\":false}],\"slidesList\":[{\"id\":\"2d7d6b2b-a7c5-4ba0-a70a-d17552b94286\",\"type\":\"assetSlides\",\"asset_id\":\"\",\"asset_name\":\"\",\"_publicAsset\":false}],\"cardList\":[{\"id\":\"69fafd04-d186-4186-8d1c-38aa311ce013\",\"asset_id\":\"\",\"text\":\"\"}]},\"transitions\":[{\"event\":\"next\",\"next\":\"PostGetOrderExists\",\"id\":\"d8728a4d-2837-4087-b728-add964989669\",\"friendlyName\":\"Next Step\"},{\"event\":\"sendMediaFailed\",\"friendlyName\":\"Send Media Failed\",\"_tooltip\":\"Media failed to send to the end customer\",\"next\":\"PostDisplayError\",\"id\":\"613f049d-39a3-4961-b1d7-929eab3ae858\"}]},{\"id\":\"6946f3d2-9c14-4886-b658-e4a33537133f\",\"name\":\"PostGetOrderExists\",\"type\":\"Variable\",\"top\":1309,\"left\":4716,\"properties\":{\"script\":\"/*\\nINPUT PARAMETERS FOR DEBUGGING\\n\\n{\\n\\\"global_custom.accShopify.orderId\\\":123456,\\n\\\"FlowConfig.Name\\\":\\\"DebugFlow\\\"\\n}\\n\\n*/\\n\\nasync function main () {\\n  const scriptBlockName = \\\"OrderExists\\\";\\n  try {\\n    let orderId = var_get()[\\\"global_custom.accShopify.orderId\\\"];\\n    let orderStatus = (var_get()[\\\"global_custom.accShopify.orderStatus\\\"] != null) ? var_get()[\\\"global_custom.accShopify.orderStatus\\\"] : \\\"null\\\";\\n    let orderPaymentStatus = (var_get()[\\\"global_custom.accShopify.orderPaymentStatus\\\"] != null) ? var_get()[\\\"global_custom.accShopify.orderPaymentStatus\\\"] : \\\"null\\\";\\n    let orderCancelReason = (var_get()[\\\"global_custom.accShopify.orderCancelReason\\\"] != null) ? var_get()[\\\"global_custom.accShopify.orderCancelReason\\\"] : \\\"null\\\";\\n    let orderCancelledAt = (var_get()[\\\"global_custom.accShopify.orderCancelledAt\\\"] != null) ? var_get()[\\\"global_custom.accShopify.orderCancelledAt\\\"] : \\\"null\\\";\\n\\tlet orderNote = (var_get()[\\\"global_custom.accShopify.orderNote\\\"] != null) ? var_get()[\\\"global_custom.accShopify.orderNote\\\"] : \\\"null\\\";\\n    let orderPhone = (var_get()[\\\"global_custom.accShopify.orderPhone\\\"] != null) ? var_get()[\\\"global_custom.accShopify.orderPhone\\\"] : \\\"null\\\";\\n\\tlet orderTotalPrice = (var_get()[\\\"global_custom.accShopify.orderTotalPrice\\\"] != null) ? var_get()[\\\"global_custom.accShopify.orderTotalPrice\\\"] : \\\"null\\\";\\n    \\n    if (orderId == null || orderId == \\\"\\\") {\\n      return false;\\n    } else {\\n      // use local variables for any nullable values - this prevents issues when displaying in the SendMedia block\\n      var_set(\\\"orderStatus\\\", \\\"orderStatus: \\\" + orderStatus);\\n      var_set(\\\"orderPaymentStatus\\\", \\\"orderPaymentStatus: \\\" + orderPaymentStatus);\\n      var_set(\\\"orderCancelReason\\\", \\\"orderCancelReason: \\\" + orderCancelReason);\\n      var_set(\\\"orderCancelledAt\\\", \\\"orderCancelledAt: \\\" + orderCancelledAt);\\n      var_set(\\\"orderNote\\\", \\\"orderNote: \\\" + orderNote);\\n      var_set(\\\"orderPhone\\\", \\\"orderPhone: \\\" + orderPhone);\\n      var_set(\\\"orderTotalPrice\\\", \\\"orderTotalPrice: \\\" + orderTotalPrice);      \\n      return true;\\n    }\\n  } catch (error) {\\n    log.debug(\\\"Unexpected error: \\\" + error + \\\" - [flow: \\\" + var_get()[\\\"FlowConfig.name\\\"] + \\\"] - [version: \\\" + var_get()[\\\"FlowConfig.version\\\"] + \\\"] - [block: \\\" + scriptBlockName + \\\"]\\\");\\n    global_var_set(\\\"global_custom.accShopify.errorCode\\\",9000);\\n    global_var_set(\\\"global_custom.accShopify.errorMessage\\\",\\\"Unexpected error: \\\" + error + \\\" - [flow: \\\" + var_get()[\\\"FlowConfig.name\\\"] + \\\"] - [version: \\\" + var_get()[\\\"FlowConfig.version\\\"] + \\\"] - [block: \\\" + scriptBlockName + \\\"]\\\");\\n    return false;\\n  }\\n}\",\"language\":\"javascript\",\"name\":\"PostGetOrderExists\",\"sdkVersion\":2},\"transitions\":[{\"event\":\"Success\",\"friendlyName\":\"Success\",\"next\":\"PostCheckOrderExists\",\"id\":\"80e14df2-452f-4d9d-969c-093f11fdf38d\"},{\"event\":\"Fail\",\"friendlyName\":\"Fail\",\"next\":\"PostDisplayError\",\"id\":\"e102de38-a5ce-462b-9e8b-f063eedf7ced\"}]},{\"id\":\"1d989b5a-6c84-4938-8e8e-96978b812994\",\"name\":\"PostCheckOrderExists\",\"type\":\"Condition\",\"top\":1447.857142857143,\"left\":5125.142857142857,\"properties\":{\"type\":\"variable\",\"variable\":\"{{PostGetOrderExists.value}}\",\"queueId\":\"\"},\"transitions\":[{\"friendlyName\":\"No Match\",\"event\":\"noMatch\",\"next\":null,\"id\":\"7dc409a8-0d92-4c1f-ad0f-12b7e34efaf7\"},{\"id\":\"70e665cf-a151-4781-adcf-39c8b49bc91e\",\"event\":\"Match\",\"condition\":null,\"conditionList\":[{\"value\":\"true\",\"operator\":\"Equal to\",\"preOperator\":\"None\"}],\"friendlyName\":\"True\",\"categoryId\":\"\",\"skillId\":\"\",\"skillName\":\"\",\"next\":\"PostDisplayOrder\"}]},{\"id\":\"fb042cb6-8d47-4740-8394-e0da7ccc68b9\",\"name\":\"PostDisplayOrder\",\"type\":\"SendMedia\",\"top\":1657,\"left\":5219,\"properties\":{\"media_type\":\"textimage\",\"promptAudioId\":\"\",\"promptAudioName\":\"\",\"enablePromptAudio\":false,\"allowInterrupt\":true,\"_isPublicPromptAudio\":false,\"audioList\":[{\"id\":\"493b6191-6ef5-4548-8409-572726c65e01\",\"type\":\"speechAudio\",\"voice_id\":\"Joanna\",\"lang\":\"en-US\",\"asset_id\":\"\",\"asset_name\":\"\",\"message\":\"\",\"_publicAsset\":false}],\"videoList\":[{\"id\":\"efff61bf-dcfc-4f5b-a94b-c861c3877cfa\",\"type\":\"assetVideo\",\"asset_id\":\"\",\"asset_name\":\"\",\"_publicAsset\":false,\"text\":\"\",\"enableText\":true,\"enableImage\":false}],\"chatList\":[{\"id\":\"5244ca04-f352-40b4-a4ad-3a434a42283d\",\"type\":\"assetImage\",\"asset_id\":\"\",\"asset_name\":\"\",\"text\":{\"ops\":[{\"attributes\":{\"color\":\"rgba(4, 4, 19, 0.56)\"},\"insert\":\"The following order variables have been set within the accShopify group:\"},{\"insert\":\"\\n\"}]},\"audio_id\":\"\",\"enableText\":true,\"enableImage\":false,\"enableAudio\":false,\"audio_name\":\"\",\"_publicAudio\":false,\"SMSText\":\"The following order variables have been set within the accShopify group:\\n\"},{\"id\":\"4f1d12a2-f34b-4c40-b545-93c8d9b35c05\",\"type\":\"assetImage\",\"asset_id\":\"\",\"asset_name\":\"\",\"text\":{\"ops\":[{\"insert\":\"orderId: {{global_custom.accShopify.orderId}}\\norderNumber: {{global_custom.accShopify.orderNumber}}\\n{{PostGetOrderExists.orderStatus}}\\n{{PostGetOrderExists.orderPaymentStatus}}\\norderShippingAddress: JSON output hidden\\n{{PostGetOrderExists.orderCancelReason}}\\n{{PostGetOrderExists.orderCancelledAt}}\\norderLineItems: JSON output hidden\\n{{PostGetOrderExists.orderNote}}\\n{{PostGetOrderExists.orderPhone}}\\norderTotalPrice: {{global_custom.accShopify.orderTotalPrice}}\\n\"}]},\"SMSText\":\"orderId: {{global_custom.accShopify.orderId}}\\norderNumber: {{global_custom.accShopify.orderNumber}}\\n{{PostGetOrderExists.orderStatus}}\\n{{PostGetOrderExists.orderPaymentStatus}}\\norderShippingAddress: JSON output hidden\\n{{PostGetOrderExists.orderCancelReason}}\\n{{PostGetOrderExists.orderCancelledAt}}\\norderLineItems: JSON output hidden\\n{{PostGetOrderExists.orderNote}}\\n{{PostGetOrderExists.orderPhone}}\\norderTotalPrice: {{global_custom.accShopify.orderTotalPrice}}\\n\",\"enableText\":true,\"enableImage\":false,\"enableAudio\":false,\"audio_id\":\"\",\"audio_name\":\"\",\"_publicAudio\":false}],\"slidesList\":[{\"id\":\"29077a97-c5f3-4e27-b810-619de5b56c37\",\"type\":\"assetSlides\",\"asset_id\":\"\",\"asset_name\":\"\",\"_publicAsset\":false}],\"cardList\":[{\"id\":\"45dd6a07-5ba9-4a63-b758-8b71c6c8d9fe\",\"asset_id\":\"\",\"text\":\"\"}]},\"transitions\":[{\"event\":\"next\",\"next\":null,\"id\":\"cad61dd6-cb75-4721-9132-37b617d3052f\",\"friendlyName\":\"Next Step\"},{\"event\":\"sendMediaFailed\",\"friendlyName\":\"Send Media Failed\",\"_tooltip\":\"Media failed to send to the end customer\",\"next\":\"PostDisplayError\",\"id\":\"d47afb87-971d-4ab2-b03c-e0065d1af4f8\"}]}]}"}