{"flowName":"accShopifyVoice","studioType":0,"desc":"","versionDesc":"","status":2,"version":6,"eventAction":"{\"eventActions\":[]}","widgetsJson":"{\"state\":[{\"id\":\"c5a6ca28-519d-47db-a259-f3c9a9ec8413\",\"name\":\"Start\",\"type\":\"Start\",\"top\":310,\"left\":310,\"start\":true,\"acceptable\":false,\"properties\":{},\"transitions\":[{\"event\":\"Voice\",\"conditions\":[],\"next\":\"FlowConfig\",\"friendlyName\":\"Voice\",\"id\":\"d6d85ecd-5388-4e5c-b8e3-c1f0467feef6\"}]},{\"id\":\"590c0b6e-3a2a-450a-a255-39a1338dee3e\",\"name\":\"FlowConfig\",\"type\":\"Variable\",\"top\":492.25,\"left\":514.5,\"properties\":{\"script\":\"/*\\nINPUT PARAMETERS FOR DEBUGGING\\n\\n{\\n\\\"FlowConfig.name\\\":\\\"TestFlow\\\",\\n\\\"FlowConfig.version\\\":\\\"1\\\"\\n}\\n*/\\n\\nasync function main () {\\n  const flowName = \\\"accShopifyVoice\\\";\\n  const scriptBlockName = \\\"FlowConfig\\\";\\n  const version = \\\"1\\\";\\n  \\n  try {\\n    var_set(\\\"name\\\",flowName);\\n    var_set(\\\"version\\\",version);\\n    \\n    return true;\\n    \\n  } catch (error) {\\n    log.debug(\\\"Unexpected error: \\\" + error + \\\" - [flow: \\\" + flowName + \\\"] - [version: \\\" + version + \\\"] - [block: \\\" + scriptBlockName + \\\"]\\\");\\n    global_var_set(\\\"global_custom.accShopify.errorCode\\\",9000);\\n    global_var_set(\\\"global_custom.accShopify.errorMessage\\\",\\\"Unexpected error: \\\" + error + \\\" - [flow: \\\" + flowName + \\\"] - [version: \\\" + version + \\\"] - [block: \\\" + scriptBlockName + \\\"]\\\");\\n    return false;\\n  }\\n}\\n\",\"language\":\"javascript\",\"name\":\"FlowConfig\",\"sdkVersion\":2},\"transitions\":[{\"event\":\"Success\",\"friendlyName\":\"Success\",\"next\":\"PreResetVariables\",\"id\":\"2b3c1e88-e6dd-4bdc-b11b-06351b412fea\"},{\"event\":\"Fail\",\"friendlyName\":\"Fail\",\"next\":null,\"id\":\"7794a7bb-57c0-437d-8538-faab91ba3e5b\"}]},{\"id\":\"1f6bb6f7-7a06-4eb9-81ed-16956bdd43ae\",\"name\":\"PreResetVariables\",\"type\":\"Variable\",\"top\":316.25,\"left\":918.5,\"properties\":{\"script\":\"/*\\nINPUT PARAMETERS FOR DEBUGGING\\n\\n{\\n\\\"FlowConfig.name\\\":\\\"TestFlow\\\",\\n\\\"FlowConfig.version\\\":\\\"1\\\"\\n}\\n*/\\n\\nasync function main () {\\n  const scriptBlockName = \\\"PreResetVariables\\\";\\n  \\n  try {\\n    // clear out any previously set error variables\\n    global_var_set(\\\"global_custom.accShopify.errorCode\\\",\\\"\\\");\\n    global_var_set(\\\"global_custom.accShopify.errorMessage\\\",\\\"\\\");\\n    // clear out any previously set custom variables\\n    global_var_set(\\\"global_custom.accShopify.customerEmail\\\",\\\"\\\");\\n    global_var_set(\\\"global_custom.accShopify.customerPhone\\\",\\\"\\\");\\n    global_var_set(\\\"global_custom.accShopify.orderNumber\\\",\\\"\\\");\\n    return true;\\n    \\n  } catch (error) {\\n    log.debug(\\\"Unexpected error: \\\" + error + \\\" - [flow: \\\" + var_get()[\\\"FlowConfig.name\\\"] + \\\"] - [version: \\\" + var_get()[\\\"FlowConfig.version\\\"] + \\\"] - [block: \\\" + scriptBlockName + \\\"]\\\");\\n    global_var_set(\\\"global_custom.accShopify.errorCode\\\",9000);\\n    global_var_set(\\\"global_custom.accShopify.errorMessage\\\",\\\"Unexpected error: \\\" + error + \\\" - [flow: \\\" + var_get()[\\\"FlowConfig.name\\\"] + \\\"] - [version: \\\" + var_get()[\\\"FlowConfig.version\\\"] + \\\"] - [block: \\\" + scriptBlockName + \\\"]\\\");\\n    return false;\\n  }\\n}\\n\",\"language\":\"javascript\",\"name\":\"PreResetVariables\",\"sdkVersion\":2},\"transitions\":[{\"event\":\"Success\",\"friendlyName\":\"Success\",\"next\":\"PreGetSearchMethod\",\"id\":\"20afe151-5858-4a4f-9f0a-67ebdc98599c\"},{\"event\":\"Fail\",\"friendlyName\":\"Fail\",\"next\":null,\"id\":\"b4ef67da-9d94-4791-bf70-fa17c7d2ab7d\"}]},{\"id\":\"aa8ad3c3-295f-4028-94ea-d039b8565486\",\"name\":\"PreGetSearchMethod\",\"type\":\"CollectInput\",\"top\":526,\"left\":1066,\"properties\":{\"collectType\":\"ivrMenu\",\"audioList\":[{\"id\":\"1440f277-8079-41b0-9e64-0efeff6e260d\",\"type\":\"speechAudio\",\"voice_id\":\"Joanna\",\"lang\":\"en-US\",\"asset_id\":\"\",\"asset_name\":\"\",\"message\":\"How would you like to search for your customer details?  Press one, to search by phone number.  Press two, to search by order number.\",\"_publicAsset\":false,\"file_id\":\"\"}],\"videoList\":[],\"cardList\":[{\"id\":\"eb208f55-867d-4440-9f47-cd8d551ce198\",\"asset_id\":\"\",\"text\":\"\"}],\"numberOfDigits\":1,\"finishOnKey\":\"\",\"timeoutInterval\":10,\"enableTimeout\":false,\"promptMediaType\":\"\",\"promptVideoId\":\"\",\"promptVideoName\":\"\",\"_isPublicVideo\":false,\"promptImageId\":\"\",\"promptImageName\":\"\",\"_isPublicImage\":false,\"promptAudioId\":\"\",\"promptAudioName\":\"\",\"enablePromptAudio\":false,\"_isPublicAudio\":false,\"promptText\":{},\"promtSMSText\":\"\",\"enablePromptText\":true,\"allowInterrupt\":true,\"endingKey\":\"\",\"inputLength\":[1,10],\"quickReplyType\":\"button\",\"textInputLengthMin\":1,\"textInputLengthMax\":10,\"promptSlidesId\":\"\",\"promptSlidesName\":\"\",\"_isPublicPromptSlides\":false,\"enableVideoTimeOut\":true},\"transitions\":[{\"event\":\"timeout\",\"friendlyName\":\"Timeout\",\"next\":\"SendMedia\",\"id\":\"48d83e26-3758-493d-aa1a-a59e7d5edf3f\"},{\"event\":\"noMatch\",\"friendlyName\":\"No Match\",\"next\":\"SendMedia\",\"id\":\"6d0c5330-5bff-4eb7-8261-0ef3ff0c9f6f\"},{\"id\":\"1d8d7766-8d51-42aa-baa4-dd7f89229573\",\"isKeypress\":true,\"isVoice\":false,\"isButtonInput\":false,\"condition\":{\"operator\":\"equal\",\"value\":\"1\"},\"buttonName\":\"\",\"keywords\":[],\"event\":\"Match\",\"friendlyName\":\"Phone number\",\"categoryId\":\"\",\"skillId\":\"\",\"skillName\":\"\",\"next\":\"PreCollectPhone\"},{\"id\":\"c695e1bb-e04e-4100-b07d-218d34bb88ee\",\"isKeypress\":true,\"isVoice\":false,\"isButtonInput\":false,\"condition\":{\"operator\":\"equal\",\"value\":\"2\"},\"buttonName\":\"\",\"keywords\":[],\"event\":\"Match\",\"friendlyName\":\"Order number\",\"categoryId\":\"\",\"skillId\":\"\",\"skillName\":\"\",\"next\":\"PreCollectOrderNum\"}]},{\"id\":\"379eabda-646c-4d3a-bcc0-66fd7e3d00cf\",\"name\":\"PreCollectPhone\",\"type\":\"CollectInput\",\"top\":418,\"left\":1454,\"properties\":{\"collectType\":\"digitInput\",\"audioList\":[{\"id\":\"44b0c96c-1361-4ea9-b487-e1609e2d78bf\",\"type\":\"speechAudio\",\"voice_id\":\"Joanna\",\"lang\":\"en-US\",\"asset_id\":\"\",\"asset_name\":\"\",\"message\":\"Please enter your phone number and then press hash\",\"_publicAsset\":false,\"file_id\":\"\"}],\"videoList\":[],\"cardList\":[{\"id\":\"426cdf89-dfdc-4999-9104-97fbf910fbfb\",\"asset_id\":\"\",\"text\":\"\"}],\"numberOfDigits\":15,\"finishOnKey\":\"#\",\"timeoutInterval\":10,\"enableTimeout\":false,\"promptMediaType\":\"\",\"promptVideoId\":\"\",\"promptVideoName\":\"\",\"_isPublicVideo\":false,\"promptImageId\":\"\",\"promptImageName\":\"\",\"_isPublicImage\":false,\"promptAudioId\":\"\",\"promptAudioName\":\"\",\"enablePromptAudio\":false,\"_isPublicAudio\":false,\"promptText\":{},\"promtSMSText\":\"\",\"enablePromptText\":true,\"allowInterrupt\":true,\"endingKey\":\"\",\"inputLength\":[1,10],\"quickReplyType\":\"button\",\"textInputLengthMin\":1,\"textInputLengthMax\":10,\"promptSlidesId\":\"\",\"promptSlidesName\":\"\",\"_isPublicPromptSlides\":false,\"enableVideoTimeOut\":true},\"transitions\":[{\"event\":\"endOfInput\",\"friendlyName\":\"End of Input\",\"next\":\"PreSearchByPhone\",\"id\":\"f55558a2-e4a7-4aa2-95dd-b703cc77a57d\"},{\"event\":\"incorrectInput\",\"friendlyName\":\"Incorrect Input\",\"next\":\"SendMedia\",\"id\":\"0061511f-8c6c-40b1-9d31-fdc589dcb257\"},{\"event\":\"timeout\",\"friendlyName\":\"Timeout\",\"next\":\"SendMedia\",\"id\":\"f66568fc-90a8-4399-93ac-28b03b2c1b4e\"}]},{\"id\":\"8e6ee306-1186-497d-ab06-984a090e8663\",\"name\":\"PreCollectOrderNum\",\"type\":\"CollectInput\",\"top\":697.5,\"left\":1423.5,\"properties\":{\"collectType\":\"digitInput\",\"audioList\":[{\"id\":\"44b0c96c-1361-4ea9-b487-e1609e2d78bf\",\"type\":\"speechAudio\",\"voice_id\":\"Joanna\",\"lang\":\"en-US\",\"asset_id\":\"\",\"asset_name\":\"\",\"message\":\"Please enter your order number and then press hash\",\"_publicAsset\":false,\"file_id\":\"\"}],\"videoList\":[],\"cardList\":[{\"id\":\"426cdf89-dfdc-4999-9104-97fbf910fbfb\",\"asset_id\":\"\",\"text\":\"\"}],\"numberOfDigits\":10,\"finishOnKey\":\"#\",\"timeoutInterval\":10,\"enableTimeout\":false,\"promptMediaType\":\"\",\"promptVideoId\":\"\",\"promptVideoName\":\"\",\"_isPublicVideo\":false,\"promptImageId\":\"\",\"promptImageName\":\"\",\"_isPublicImage\":false,\"promptAudioId\":\"\",\"promptAudioName\":\"\",\"enablePromptAudio\":false,\"_isPublicAudio\":false,\"promptText\":{},\"promtSMSText\":\"\",\"enablePromptText\":true,\"allowInterrupt\":true,\"endingKey\":\"\",\"inputLength\":[1,10],\"quickReplyType\":\"button\",\"textInputLengthMin\":1,\"textInputLengthMax\":10,\"promptSlidesId\":\"\",\"promptSlidesName\":\"\",\"_isPublicPromptSlides\":false,\"enableVideoTimeOut\":true},\"transitions\":[{\"event\":\"endOfInput\",\"friendlyName\":\"End of Input\",\"next\":\"PreSearchByOrderNum\",\"id\":\"683a0af4-1a8f-4e89-86c5-685bdcc5e298\"},{\"event\":\"incorrectInput\",\"friendlyName\":\"Incorrect Input\",\"next\":\"SendMedia\",\"id\":\"7da36e5f-d8f1-4d93-8fc2-1966f6a572a3\"},{\"event\":\"timeout\",\"friendlyName\":\"Timeout\",\"next\":\"SendMedia\",\"id\":\"4cedeafd-ec48-422d-af30-90426905d970\"}]},{\"id\":\"a84f7aa4-dc1d-4bf1-a946-6f8806bffec1\",\"name\":\"SendMedia\",\"type\":\"SendMedia\",\"top\":1267.5714285714284,\"left\":658.5714285714286,\"properties\":{\"media_type\":\"audio\",\"promptAudioId\":\"\",\"promptAudioName\":\"\",\"enablePromptAudio\":false,\"allowInterrupt\":true,\"_isPublicPromptAudio\":false,\"audioList\":[{\"id\":\"6fde08ae-31d5-42e1-a449-aa0d1c45a5b4\",\"type\":\"speechAudio\",\"voice_id\":\"Joanna\",\"lang\":\"en-US\",\"asset_id\":\"\",\"asset_name\":\"\",\"message\":\"Sorry, I didn't quite get that.\",\"_publicAsset\":false,\"file_id\":\"\"}],\"videoList\":[{\"id\":\"25b9bdf5-acce-4b64-aff7-16abf242e319\",\"type\":\"assetVideo\",\"asset_id\":\"\",\"asset_name\":\"\",\"_publicAsset\":false,\"text\":\"\",\"enableText\":true,\"enableImage\":false}],\"chatList\":[{\"id\":\"21f6de95-4bf3-4a6f-89db-7a1c96ab220e\",\"type\":\"assetImage\",\"asset_id\":\"\",\"asset_name\":\"\",\"text\":{},\"audio_id\":\"\",\"enableText\":true,\"enableImage\":false,\"enableAudio\":false,\"audio_name\":\"\",\"_publicAudio\":false}],\"slidesList\":[{\"id\":\"1eb3090f-6c5a-4ab8-89df-28461296aca6\",\"type\":\"assetSlides\",\"asset_id\":\"\",\"asset_name\":\"\",\"_publicAsset\":false}],\"cardList\":[{\"id\":\"2b758fec-55ac-4951-bb23-d3c86bded767\",\"asset_id\":\"\",\"text\":\"\"}]},\"transitions\":[{\"event\":\"next\",\"next\":\"PreGetSearchMethod\",\"id\":\"ef76270e-7309-47e7-96b8-f5f854c64733\",\"friendlyName\":\"Next Step\"},{\"event\":\"sendMediaFailed\",\"friendlyName\":\"Send Media Failed\",\"_tooltip\":\"Media failed to send to the end customer\",\"next\":null,\"id\":\"648af981-d6a8-4bb7-9361-53cf3bb6b912\"}]},{\"id\":\"8c9a8767-cae2-47d6-8186-f534cceeaf8e\",\"name\":\"PreSearchByPhone\",\"type\":\"SetVariables\",\"top\":350.57142857142856,\"left\":1911.7142857142858,\"properties\":{\"variables\":[{\"id\":\"2553061f-7394-48cb-b7b3-cc0be050c2b5\",\"target\":\"{{global_custom.accShopify.searchMethod}}\",\"source\":\"customerByPhone\",\"mode\":\"fromValue\",\"targetId\":\"f45d4072-367b-4ba2-a8b7-f4be1f490678\",\"targetDataType\":\"String\",\"sourceId\":\"\"}]},\"transitions\":[{\"event\":\"next\",\"next\":\"PreSetVariables\",\"id\":\"8916b134-3908-4de1-9492-6e554ef9efbe\"}]},{\"id\":\"2f139d5f-40ca-464b-bf25-55d237a8d085\",\"name\":\"PreSearchByOrderNum\",\"type\":\"SetVariables\",\"top\":540.5714285714286,\"left\":1915,\"properties\":{\"variables\":[{\"id\":\"2553061f-7394-48cb-b7b3-cc0be050c2b5\",\"target\":\"{{global_custom.accShopify.searchMethod}}\",\"source\":\"orderByNumber\",\"mode\":\"fromValue\",\"targetId\":\"f45d4072-367b-4ba2-a8b7-f4be1f490678\",\"targetDataType\":\"String\",\"sourceId\":\"\"}]},\"transitions\":[{\"event\":\"next\",\"next\":\"PreSetVariables\",\"id\":\"f21afa2e-f6cf-4587-846f-1c68ae2f0aff\"}]},{\"id\":\"36a77c03-32e8-48e9-bff7-0d0cac70d8ed\",\"name\":\"PreSetVariables\",\"type\":\"Variable\",\"top\":675,\"left\":2353,\"properties\":{\"script\":\"/*\\nINPUT PARAMETERS FOR DEBUGGING\\n\\n{\\n\\\"CollectPhone.DigitInput\\\":\\\"01611234567\\\",\\n\\\"global_custom.accShopify.customerPhone\\\":\\\"441611234567\\\"\\n}\\n\\n*/\\n\\nasync function main () {\\n  const scriptBlockName = \\\"SetVariables\\\";\\n\\n  try {\\n    let phone = var_get()[\\\"CollectPhone.Digits\\\"];\\n    let orderNumber = var_get()[\\\"CollectOrderNumber.Digits\\\"];\\n        \\n    // log.debug(\\\"phone: \\\" + phone);\\n    if (phone != null){\\n      phone = enforcePhoneNumberPattern(phone);\\n      global_var_set(\\\"global_custom.accShopify.customerPhone\\\", phone);\\n      if (phone.length == 0 || var_get()[\\\"global_custom.accShopify.customerPhone\\\"] == null) {\\n        global_var_set(\\\"global_custom.accShopify.errorCode\\\",1005);\\n        global_var_set(\\\"global_custom.accShopify.errorMessage\\\",\\\"Supplied phone number not valid\\\" + \\\" - [flow: \\\" + var_get()[\\\"FlowConfig.name\\\"] + \\\"] - [version: \\\" + var_get()[\\\"FlowConfig.version\\\"] + \\\"] - [block: \\\" + scriptBlockName + \\\"]\\\");\\n        return false;\\n      }\\n    }\\n    \\n    // log.debug(\\\"orderNumber: \\\" + var_get()[\\\"CollectOrderNumber.DigitInput\\\"]);\\n    if (orderNumber != null){\\n      global_var_set(\\\"global_custom.accShopify.orderNumber\\\", orderNumber);\\n    }\\n       \\n    return true;\\n    \\n  } catch (error) {    \\n    log.debug(\\\"Unexpected error: \\\" + error + \\\" - [flow: \\\" + var_get()[\\\"FlowConfig.name\\\"] + \\\"] - [version: \\\" + var_get()[\\\"FlowConfig.version\\\"] + \\\"] - [block: \\\" + scriptBlockName + \\\"]\\\");\\n    global_var_set(\\\"global_custom.accShopify.errorCode\\\",9000);\\n    global_var_set(\\\"global_custom.accShopify.errorMessage\\\",\\\"Unexpected error: \\\" + error + \\\" - [flow: \\\" + var_get()[\\\"FlowConfig.name\\\"] + \\\"] - [version: \\\" + var_get()[\\\"FlowConfig.version\\\"] + \\\"] - [block: \\\" + scriptBlockName + \\\"]\\\");\\n    return false;\\n  }\\n}\\n\\n// rudimentary function to format a phone number to E164\\nfunction enforcePhoneNumberPattern(stringNumber) {\\n  let newString = stringNumber.match(/[0-9]{0,14}/g);\\n  let defaultCountryPrefix = '44';  // UK country code\\n  if (newString === null) {\\n    return '';\\n  }\\n  newString = newString.join('');  \\n  // defaults numbers to UK if not already specified\\n  // if (!newString.startsWith(\\\"44\\\")){\\n    if (newString.startsWith(\\\"0\\\")){\\n      newString = newString.substring(1, 15);\\n      newString = defaultCountryPrefix + newString;\\n    }\\n  // }\\n  // Limit length to 15 characters\\n  newString = newString.substring(0, 15);\\n  return newString;\\n}\\n\",\"language\":\"javascript\",\"name\":\"PreSetVariables\",\"sdkVersion\":2},\"transitions\":[{\"event\":\"Success\",\"friendlyName\":\"Success\",\"next\":\"PreCheckSetVariables\",\"id\":\"6de11718-926b-4015-af9d-36462cf902c8\"},{\"event\":\"Fail\",\"friendlyName\":\"Fail\",\"next\":null,\"id\":\"6241ed81-3788-43c6-a9e4-bd2d0ad46bb7\"}]},{\"id\":\"d9e6b0be-32cf-4cae-b50a-35b81c0a342b\",\"name\":\"PreCheckSetVariables\",\"type\":\"Condition\",\"top\":560.4285714285714,\"left\":2740.714285714286,\"properties\":{\"type\":\"variable\",\"variable\":\"{{PreSetVariables.value}}\",\"queueId\":\"\"},\"transitions\":[{\"event\":\"noMatch\",\"next\":\"PreDisplayError\",\"friendlyName\":\"No Match\",\"id\":\"5ca7891d-337c-4530-a369-77c7bc5258fb\"},{\"id\":\"a2c73b34-4810-494b-b46d-8f723e3b0cf1\",\"event\":\"Match\",\"condition\":null,\"conditionList\":[{\"value\":\"true\",\"operator\":\"Equal to\",\"preOperator\":\"None\"}],\"friendlyName\":\"True\",\"categoryId\":\"\",\"skillId\":\"\",\"skillName\":\"\",\"next\":\"ValidateSetup\"}]},{\"id\":\"556ba5a1-da25-43bf-848b-4dd6e22a15f8\",\"name\":\"PreDisplayError\",\"type\":\"SendMedia\",\"top\":275.1428571428571,\"left\":2522.8571428571427,\"properties\":{\"media_type\":\"audio\",\"promptAudioId\":\"\",\"promptAudioName\":\"\",\"enablePromptAudio\":false,\"allowInterrupt\":true,\"_isPublicPromptAudio\":false,\"audioList\":[{\"id\":\"2e5832d9-6fbe-406a-87ca-f9a61402a3d4\",\"type\":\"speechAudio\",\"voice_id\":\"Joanna\",\"lang\":\"en-US\",\"asset_id\":\"\",\"asset_name\":\"\",\"message\":\"Oooops!  Something went wrong...\\nError code: {{global_custom.accShopify.errorCode}};\\nError message: {{global_custom.accShopify.errorMessage}}\",\"_publicAsset\":false,\"file_id\":\"\"}],\"videoList\":[{\"id\":\"f3f84b84-6357-442c-b211-c95e396b1e17\",\"type\":\"assetVideo\",\"asset_id\":\"\",\"asset_name\":\"\",\"_publicAsset\":false,\"text\":\"\",\"enableText\":true,\"enableImage\":false}],\"chatList\":[{\"id\":\"9cc62766-3875-46e3-98e5-447f644c5268\",\"type\":\"assetImage\",\"asset_id\":\"\",\"asset_name\":\"\",\"text\":{},\"audio_id\":\"\",\"enableText\":true,\"enableImage\":false,\"enableAudio\":false,\"audio_name\":\"\",\"_publicAudio\":false}],\"slidesList\":[{\"id\":\"0c7db588-841d-48ff-8b3b-c0b7b642628f\",\"type\":\"assetSlides\",\"asset_id\":\"\",\"asset_name\":\"\",\"_publicAsset\":false}],\"cardList\":[{\"id\":\"41be6766-9c42-46ac-ac2a-4606593f9e51\",\"asset_id\":\"\",\"text\":\"\"}]},\"transitions\":[{\"event\":\"next\",\"next\":null,\"id\":\"7b27adad-b32f-45f6-ad4c-d6cb935f1999\",\"friendlyName\":\"Next Step\"},{\"event\":\"sendMediaFailed\",\"friendlyName\":\"Send Media Failed\",\"_tooltip\":\"Media failed to send to the end customer\",\"next\":null,\"id\":\"d691d29b-bc71-4897-ac90-e7bef7665dbd\"}]},{\"id\":\"8d09e075-f40d-4adc-b9b0-0039336387dd\",\"name\":\"ValidateSetup\",\"type\":\"Variable\",\"top\":283,\"left\":3503.714285714286,\"properties\":{\"script\":\"/*\\nINPUT PARAMETERS FOR DEBUGGING\\n\\n{\\n\\\"global_custom.accShopify.apiKey\\\":\\\"TESTKEY\\\",\\n\\\"global_custom.accShopify.storeName\\\":\\\"test-value\\\",\\n\\\"FlowConfig.name\\\":\\\"TestFlow\\\"\\n}\\n\\n*/\\n\\nasync function main () {\\n  \\n  const scriptBlockName = \\\"ValidateSetup\\\";\\n\\n  let shopifyApiKey;\\n  let shopifyStoreName;\\n  \\n  try {\\n    shopifyApiKey = var_get()[\\\"global_custom.accShopify.apiKey\\\"];\\n    shopifyStoreName = var_get()[\\\"global_custom.accShopify.storeName\\\"];\\n\\n    // check we've got all the required values to call the endpoint\\n    if (shopifyApiKey == null){\\n      global_var_set(\\\"global_custom.accShopify.errorCode\\\",1001);\\n      global_var_set(\\\"global_custom.accShopify.errorMessage\\\",\\\"No API Key defined\\\" + \\\" - [flow: \\\" + var_get()[\\\"FlowConfig.name\\\"] + \\\"] - [version: \\\" + var_get()[\\\"FlowConfig.version\\\"] + \\\"] - [block: \\\" + scriptBlockName + \\\"]\\\");\\n      return false;\\n    }\\n    if (shopifyStoreName == null){\\n      global_var_set(\\\"global_custom.accShopify.errorCode\\\",1002);\\n      global_var_set(\\\"global_custom.accShopify.errorMessage\\\",\\\"No Store Name defined\\\" + \\\" - [flow: \\\" + var_get()[\\\"FlowConfig.name\\\"] + \\\"] - [version: \\\" + var_get()[\\\"FlowConfig.version\\\"] + \\\"] - [block: \\\" + scriptBlockName + \\\"]\\\");\\n      return false;\\n    }\\n    // no conditions matched so all OK\\n    return true;\\n  } catch (error) {\\n    log.debug(\\\"Unexpected error: \\\" + error + \\\" - [flow: \\\" + var_get()[\\\"FlowConfig.name\\\"] + \\\"] - [version: \\\" + var_get()[\\\"FlowConfig.version\\\"] + \\\"] - [block: \\\" + scriptBlockName + \\\"]\\\");\\n    global_var_set(\\\"global_custom.accShopify.errorCode\\\",9000);\\n    global_var_set(\\\"global_custom.accShopify.errorMessage\\\",\\\"Unexpected error: \\\" + error + \\\" - [flow: \\\" + var_get()[\\\"FlowConfig.name\\\"] + \\\"] - [version: \\\" + var_get()[\\\"FlowConfig.version\\\"] + \\\"] - [block: \\\" + scriptBlockName + \\\"]\\\");\\n    return false;\\n  }\\n}\\n\",\"language\":\"javascript\",\"name\":\"ValidateSetup\",\"sdkVersion\":2},\"transitions\":[{\"event\":\"Success\",\"friendlyName\":\"Success\",\"next\":\"CheckValidSetup\",\"id\":\"ef59a5df-b759-47bc-a3eb-8029c2daee19\"},{\"event\":\"Fail\",\"friendlyName\":\"Fail\",\"next\":null,\"id\":\"d57fc96d-04c8-4e9c-8564-aeb774dfbbf3\"}]},{\"id\":\"1bd210dc-b912-4308-88a8-204c406bd789\",\"name\":\"CheckValidSetup\",\"type\":\"Condition\",\"top\":532.4285714285714,\"left\":3416,\"properties\":{\"type\":\"variable\",\"variable\":\"{{ValidateSetup.value}}\",\"queueId\":\"\"},\"transitions\":[{\"event\":\"noMatch\",\"next\":\"DisplayError\",\"friendlyName\":\"No Match\",\"id\":\"47aa4f1e-a1a5-4410-ac72-3c1a64e766b4\"},{\"id\":\"dcea9c79-4142-48a7-82ee-d5b18d32f5dd\",\"event\":\"Match\",\"condition\":null,\"conditionList\":[{\"value\":\"true\",\"operator\":\"Equal to\",\"preOperator\":\"None\"}],\"friendlyName\":\"True\",\"categoryId\":\"\",\"skillId\":\"\",\"skillName\":\"\",\"next\":\"GetSearchMethod\"}]},{\"id\":\"a981fa56-d316-4172-aeab-0b976fc047f6\",\"name\":\"DisplayError\",\"type\":\"SendMedia\",\"top\":565.5,\"left\":5704.75,\"properties\":{\"media_type\":\"audio\",\"promptAudioId\":\"\",\"promptAudioName\":\"\",\"enablePromptAudio\":false,\"allowInterrupt\":true,\"_isPublicPromptAudio\":false,\"audioList\":[{\"id\":\"f429a58b-3fa8-4b95-8f11-8795ef3c001d\",\"type\":\"speechAudio\",\"voice_id\":\"Joanna\",\"lang\":\"en-US\",\"asset_id\":\"\",\"asset_name\":\"\",\"message\":\"Oooops!  Something went wrong...\\nError code: {{global_custom.accShopify.errorCode}};\\nError message: {{global_custom.accShopify.errorMessage}}\",\"_publicAsset\":false,\"file_id\":\"\"}],\"videoList\":[{\"id\":\"011b9320-6004-4f31-a233-da69fe6700a6\",\"type\":\"assetVideo\",\"asset_id\":\"\",\"asset_name\":\"\",\"_publicAsset\":false,\"text\":\"\",\"enableText\":true,\"enableImage\":false}],\"chatList\":[{\"id\":\"df4c6d73-c508-4749-abbc-36c99577ca35\",\"type\":\"assetImage\",\"asset_id\":\"\",\"asset_name\":\"\",\"text\":{},\"audio_id\":\"\",\"enableText\":true,\"enableImage\":false,\"enableAudio\":false,\"audio_name\":\"\",\"_publicAudio\":false}],\"slidesList\":[{\"id\":\"e16ee199-f9be-4dd6-9692-c7415cc508c6\",\"type\":\"assetSlides\",\"asset_id\":\"\",\"asset_name\":\"\",\"_publicAsset\":false}],\"cardList\":[{\"id\":\"0149c991-cc7f-407c-81e9-e02980c29af2\",\"asset_id\":\"\",\"text\":\"\"}]},\"transitions\":[{\"event\":\"next\",\"next\":null,\"id\":\"d22d0604-33f9-49a3-8963-2001402079bc\",\"friendlyName\":\"Next Step\"},{\"event\":\"sendMediaFailed\",\"friendlyName\":\"Send Media Failed\",\"_tooltip\":\"Media failed to send to the end customer\",\"next\":null,\"id\":\"a54f8a22-fb77-4cde-82b4-e7ee07bbcae6\"}]},{\"id\":\"54a97ec8-098a-42e6-9b65-6838842d540c\",\"name\":\"GetSearchMethod\",\"type\":\"Variable\",\"top\":741.5555555555555,\"left\":3417.8888888888887,\"properties\":{\"script\":\"/*\\nINPUT PARAMETERS FOR DEBUGGING\\n\\n{\\n\\\"global_custom.accShopify.searchMethod\\\":\\\"orderByNumber\\\",\\n\\\"global_custom.accShopify.customerPhone\\\":\\\"441611234567\\\",\\n\\\"FlowConfig.name\\\":\\\"TestFlow\\\"\\n}\\n\\n*/\\n\\nasync function main () {\\n  const scriptBlockName = \\\"GetSearchMethod\\\";\\n  \\n  try {\\n    let searchMethod = var_get()[\\\"global_custom.accShopify.searchMethod\\\"];\\n    if (searchMethod != null && searchMethod != \\\"\\\") {\\n      return searchMethod;\\n    } else {      \\n      // search method not explicitly set, so work our what variables have been set to determine what search method should be used\\n      // log.debug(\\\"orderNumber: \\\" + var_get()[\\\"global_custom.accShopify.orderNumber\\\"]);\\n      if (var_get()[\\\"global_custom.accShopify.orderNumber\\\"] != null && var_get()[\\\"global_custom.accShopify.orderNumber\\\"] != \\\"\\\"){\\n        // priority 1 - search by order number\\n        searchMethod = \\\"orderByNumber\\\";\\n        return searchMethod;\\n      }\\n      // log.debug(\\\"customerPhone: \\\" + var_get()[\\\"global_custom.accShopify.customerPhone\\\"]);\\n      if (var_get()[\\\"global_custom.accShopify.customerPhone\\\"] != null && var_get()[\\\"global_custom.accShopify.customerPhone\\\"] != \\\"\\\"){\\n        // priority 2 - search by customer phone\\n        searchMethod = \\\"customerByPhone\\\";\\n        return searchMethod;\\n      }\\n    }\\n    \\n    // no criteria set so set error variables\\n    global_var_set(\\\"global_custom.accShopify.errorCode\\\",1003);\\n    global_var_set(\\\"global_custom.accShopify.errorMessage\\\",\\\"No variables set\\\"  + \\\" - [flow: \\\" + var_get()[\\\"FlowConfig.name\\\"] + \\\"] - [version: \\\" + var_get()[\\\"FlowConfig.version\\\"] + \\\"] - [block: \\\" + scriptBlockName + \\\"]\\\");\\n    return false;\\n     \\n  } catch (error) {\\n    log.debug(\\\"Unexpected error: \\\" + error + \\\" - [flow: \\\" + var_get()[\\\"FlowConfig.name\\\"] + \\\"] - [version: \\\" + var_get()[\\\"FlowConfig.version\\\"] + \\\"] - [block: \\\" + scriptBlockName + \\\"]\\\");\\n    global_var_set(\\\"global_custom.accShopify.errorCode\\\",9000);\\n    global_var_set(\\\"global_custom.accShopify.errorMessage\\\",\\\"Unexpected error: \\\" + error + \\\" - [flow: \\\" + var_get()[\\\"FlowConfig.name\\\"] + \\\"] - [version: \\\" + var_get()[\\\"FlowConfig.version\\\"] + \\\"] - [block: \\\" + scriptBlockName + \\\"]\\\");\\n    return false;\\n  }\\n}\\n\\n\",\"language\":\"javascript\",\"name\":\"GetSearchMethod\",\"sdkVersion\":2},\"transitions\":[{\"event\":\"Success\",\"friendlyName\":\"Success\",\"next\":\"CheckSearchMethod\",\"id\":\"47a73eac-f414-4648-a272-9903499133e4\"},{\"event\":\"Fail\",\"friendlyName\":\"Fail\",\"next\":\"DisplayError\",\"id\":\"19c52baf-c334-47c1-b2d4-bd0e95bd4b3c\"}]},{\"id\":\"2d6b90fb-1bdd-48ae-865f-e975a47e2a4f\",\"name\":\"CheckSearchMethod\",\"type\":\"Condition\",\"top\":999.25,\"left\":3418,\"properties\":{\"type\":\"variable\",\"variable\":\"{{GetSearchMethod.value}}\",\"queueId\":\"\"},\"transitions\":[{\"event\":\"noMatch\",\"next\":\"DisplayError\",\"friendlyName\":\"No Match\",\"id\":\"617da625-d8c9-40ee-b1be-508ee3d3d2c8\"},{\"id\":\"b31b3e4d-417f-423c-b0f7-a510b98a8038\",\"event\":\"Match\",\"condition\":null,\"conditionList\":[{\"value\":\"customerByPhone\",\"operator\":\"Equal to\",\"preOperator\":\"None\"}],\"friendlyName\":\"Customer by phone\",\"categoryId\":\"\",\"skillId\":\"\",\"skillName\":\"\",\"next\":\"GetCustomer\"},{\"id\":\"3a3006d4-fd86-4d27-a2c2-a85222e342c1\",\"event\":\"Match\",\"condition\":null,\"conditionList\":[{\"value\":\"orderByNumber\",\"operator\":\"Equal to\",\"preOperator\":\"None\"}],\"friendlyName\":\"Order by number\",\"categoryId\":\"\",\"skillId\":\"\",\"skillName\":\"\",\"next\":\"GetOrder\"}]},{\"id\":\"c5cbcd43-7d5b-4489-a990-2675e9c02572\",\"name\":\"GetCustomer\",\"type\":\"Variable\",\"top\":649,\"left\":3887,\"properties\":{\"script\":\"/*\\nINPUT PARAMETERS FOR DEBUGGING\\n\\n{\\n\\\"global_custom.accShopify.apiKey\\\":\\\"TESTKEY\\\",\\n\\\"global_custom.accShopify.storeName\\\":\\\"test-store\\\",\\n\\\"global_custom.accShopify.customerEmail\\\":\\\"xxx@yyy.com\\\",\\n\\\"GetSearchMethod.value\\\":\\\"customerByEmail\\\",\\n\\\"ProcessOrder.customerId\\\":\\\"6629291852093\\\"\\n}\\n\\n*/\\n\\nasync function main () {\\n  const scriptBlockName = \\\"GetCustomer\\\";\\n  let response;\\n  \\n  try {\\n    let shopifyApiKey = var_get()[\\\"global_custom.accShopify.apiKey\\\"];\\n    let shopifyStoreName = var_get()[\\\"global_custom.accShopify.storeName\\\"];\\n        \\n    let email = var_get()[\\\"global_custom.accShopify.customerEmail\\\"];\\n    let phone = var_get()[\\\"global_custom.accShopify.customerPhone\\\"];\\n    let customerId = var_get()[\\\"ProcessOrder.customerId\\\"];\\n    let searchMethod = var_get()[\\\"GetSearchMethod.value\\\"];\\n\\n    // set the endpoint url based on the search method\\n    let shopifyApiCustomerEndpoint = (searchMethod == \\\"orderByNumber\\\") ? `https://${shopifyStoreName}.myshopify.com//admin/api/2022-10/customers/${customerId}.json` : `https://${shopifyStoreName}.myshopify.com/admin/api/2022-10/customers/search.json`;\\n            \\n    let result;\\n    \\n    if (searchMethod == \\\"customerByPhone\\\") {\\n      result = await req.get(shopifyApiCustomerEndpoint, {\\n        headers: {\\n          'X-Shopify-Access-Token': shopifyApiKey,\\n          'Content-Type': 'application/json'\\n        },\\n        params: {\\n          'phone': phone\\n        }\\n      });      \\n    } else {\\n      result = await req.get(shopifyApiCustomerEndpoint, {\\n        headers: {\\n          'X-Shopify-Access-Token': shopifyApiKey,\\n          'Content-Type': 'application/json'\\n        }\\n      });\\n    }\\n    \\n    // customer search methods return an array, so strip out the returned object\\n    if (searchMethod == \\\"customerByPhone\\\") {\\n      if (result.data.customers.length > 0){\\n        response = result.data.customers[0];  // Store the API response\\n      } else {\\n        // no data returned so set error variables based on the search method\\n        if (searchMethod == \\\"customerByEmail\\\") {\\n          global_var_set(\\\"global_custom.accShopify.errorCode\\\",3001);\\n          global_var_set(\\\"global_custom.accShopify.errorMessage\\\",\\\"Customer not found using email address\\\" + \\\" - [flow: \\\" + var_get()[\\\"FlowConfig.name\\\"] + \\\"] - [version: \\\" + var_get()[\\\"FlowConfig.version\\\"] + \\\"] - [block: \\\" + scriptBlockName + \\\"]\\\");\\n        } else if (searchMethod == \\\"customerByPhone\\\") {\\n          global_var_set(\\\"global_custom.accShopify.errorCode\\\",3002);\\n          global_var_set(\\\"global_custom.accShopify.errorMessage\\\",\\\"Customer not found using phone number\\\" + \\\" - [flow: \\\" + var_get()[\\\"FlowConfig.name\\\"] + \\\"] - [version: \\\" + var_get()[\\\"FlowConfig.version\\\"] + \\\"] - [block: \\\" + scriptBlockName + \\\"]\\\");\\n        }\\n        return false;\\n      }\\n    } else if (searchMethod == \\\"orderByNumber\\\") {\\n      // successful order lookups already have the customer ID so only 1 object is in the response to return\\n      response = result.data.customer;\\n    }\\n    var_set(\\\"data\\\",JSON.stringify(response));\\n    return true;\\n    \\n  } catch (error) {\\n    log.debug(\\\"Unexpected error: \\\" + error + \\\" - [flow: \\\" + var_get()[\\\"FlowConfig.name\\\"] + \\\"] - [version: \\\" + var_get()[\\\"FlowConfig.version\\\"] + \\\"] - [block: \\\" + scriptBlockName + \\\"]\\\");\\n    global_var_set(\\\"global_custom.accShopify.errorCode\\\",9000);\\n    global_var_set(\\\"global_custom.accShopify.errorMessage\\\",\\\"Unexpected error: \\\" + error + \\\" - [flow: \\\" + var_get()[\\\"FlowConfig.name\\\"] + \\\"] - [version: \\\" + var_get()[\\\"FlowConfig.version\\\"] + \\\"] - [block: \\\" + scriptBlockName + \\\"]\\\");\\n    return false;\\n  }\\n}\\n\",\"language\":\"javascript\",\"name\":\"GetCustomer\",\"sdkVersion\":2},\"transitions\":[{\"event\":\"Success\",\"friendlyName\":\"Success\",\"next\":\"CheckCustomerFound\",\"id\":\"ed7bb9aa-a48e-4ca4-8254-e7a81377e829\"},{\"event\":\"Fail\",\"friendlyName\":\"Fail\",\"next\":\"DisplayError\",\"id\":\"592aa4b8-9aaa-40a2-9651-896a85ce216b\"}]},{\"id\":\"6f125806-6d74-4202-bdf0-b4a699adf139\",\"name\":\"CheckCustomerFound\",\"type\":\"Condition\",\"top\":878.75,\"left\":3999.25,\"properties\":{\"type\":\"variable\",\"variable\":\"{{GetCustomer.value}}\",\"queueId\":\"\"},\"transitions\":[{\"event\":\"noMatch\",\"next\":\"DisplayError\",\"friendlyName\":\"No Match\",\"id\":\"1eb13120-d2f9-4031-a510-b1c7b70a5767\"},{\"id\":\"8d4c849b-dabd-41cc-8d53-3930b93c3278\",\"event\":\"Match\",\"condition\":null,\"conditionList\":[{\"value\":\"true\",\"operator\":\"Equal to\",\"preOperator\":\"None\"}],\"friendlyName\":\"True\",\"categoryId\":\"\",\"skillId\":\"\",\"skillName\":\"\",\"next\":\"ProcessCustomer\"}]},{\"id\":\"1be42d05-6086-427a-82b6-3e67f7b71eae\",\"name\":\"ProcessCustomer\",\"type\":\"Variable\",\"top\":1149.75,\"left\":4385.75,\"properties\":{\"script\":\"/*\\nINPUT PARAMETERS FOR DEBUGGING\\n\\n{\\n'GetCustomer.data':'{\\\"id\\\": 6629291852093,\\\"email\\\": \\\"xxx@yyy.com\\\",\\\"first_name\\\": \\\"Test\\\",\\\"last_name\\\": \\\"Tester\\\"}',\\n'FlowConfig.name':'TestFlow'\\n}\\n\\n*/\\n\\nasync function main () {\\n  const scriptBlockName = \\\"ProcessCustomer\\\";\\n\\n  try {\\n    let response = JSON.parse(var_get()[\\\"GetCustomer.data\\\"]);\\n\\n    // popluate the custom variables\\n    global_var_set(\\\"global_custom.accShopify.customerId\\\", response.id);\\n    global_var_set(\\\"global_custom.accShopify.customerEmail\\\", response.email);\\n    global_var_set(\\\"global_custom.accShopify.customerFirstName\\\", response.first_name);\\n    global_var_set(\\\"global_custom.accShopify.customerLastName\\\", response.last_name);\\n    global_var_set(\\\"global_custom.accShopify.customerPhone\\\", response.phone);\\n    global_var_set(\\\"global_custom.accShopify.customerOrdersCount\\\", response.orders_count);\\n    global_var_set(\\\"global_custom.accShopify.customerLastOrderId\\\", response.last_order_id);\\n    global_var_set(\\\"global_custom.accShopify.customerNote\\\", response.note);\\n    global_var_set(\\\"global_custom.accShopify.customerState\\\", response.state);\\n    global_var_set(\\\"global_custom.accShopify.customerTags\\\", response.tags);\\n    global_var_set(\\\"global_custom.accShopify.customerTotalSpent\\\", response.total_spent);\\n    \\n    return true;\\n    \\n  } catch (error) {\\n    log.debug(\\\"Unexpected error: \\\" + error + \\\" - [flow: \\\" + var_get()[\\\"FlowConfig.name\\\"] + \\\"] - [version: \\\" + var_get()[\\\"FlowConfig.version\\\"] + \\\"] - [block: \\\" + scriptBlockName + \\\"]\\\");\\n    global_var_set(\\\"global_custom.accShopify.errorCode\\\",9000);\\n    global_var_set(\\\"global_custom.accShopify.errorMessage\\\",\\\"Unexpected error: \\\" + error + \\\" - [flow: \\\" + var_get()[\\\"FlowConfig.name\\\"] + \\\"] - [version: \\\" + var_get()[\\\"FlowConfig.version\\\"] + \\\"] - [block: \\\" + scriptBlockName + \\\"]\\\");\\n    return false;\\n  }\\n}\\n\",\"language\":\"javascript\",\"name\":\"ProcessCustomer\",\"sdkVersion\":2},\"transitions\":[{\"event\":\"Success\",\"friendlyName\":\"Success\",\"next\":\"CheckProcessing\",\"id\":\"a3c07a73-37eb-4696-a15d-ce6e0ff9d0bf\"},{\"event\":\"Fail\",\"friendlyName\":\"Fail\",\"next\":\"DisplayError\",\"id\":\"ec8a7b12-b6ee-4828-ba38-9c1bfbfcc21d\"}]},{\"id\":\"80334e18-4211-4d5f-82b2-18c3116b7a72\",\"name\":\"GetOrder\",\"type\":\"Variable\",\"top\":1981.75,\"left\":3857.25,\"properties\":{\"script\":\"/*\\nINPUT PARAMETERS FOR DEBUGGING\\n\\n{\\n\\\"global_custom.accShopify.apiKey\\\":\\\"TESTKEY\\\",\\n\\\"global_custom.accShopify.storeName\\\":\\\"test-store\\\",\\n\\\"global_custom.accShopify.orderNumber\\\":\\\"1002\\\",\\n\\\"global_custom.accShopify.customerLastOrderId\\\":\\\"5223006142781\\\",\\n\\\"GetSearchMethod.value\\\":\\\"customerByEmail\\\"\\n}\\n\\n*/\\n\\nasync function main () {\\n  const scriptBlockName = \\\"GetOrder\\\";\\n  let response;\\n  \\n  try {\\n    let shopifyApiKey = var_get()[\\\"global_custom.accShopify.apiKey\\\"];\\n    let shopifyStoreName = var_get()[\\\"global_custom.accShopify.storeName\\\"];\\n    \\n    let orderNumber = var_get()[\\\"global_custom.accShopify.orderNumber\\\"]; // this will be the value supplied by the customer\\n    let orderId = var_get()[\\\"global_custom.accShopify.customerLastOrderId\\\"]; // this will be the value from the customer object if searching by customer rather than order\\n    let searchMethod = var_get()[\\\"GetSearchMethod.value\\\"];\\n\\n    // set the endpoint url based on the search method\\n    let shopifyApiOrderEndpoint = (searchMethod == \\\"orderByNumber\\\") ? `https://${shopifyStoreName}.myshopify.com/admin/api/2022-10/orders.json` : `https://${shopifyStoreName}.myshopify.com/admin/api/2022-10/orders/${orderId}.json`;\\n    \\n    let result;\\n    // search for the order using the supplied parameters\\n    if (searchMethod == \\\"orderByNumber\\\") {\\n      result = await req.get(shopifyApiOrderEndpoint, {\\n        headers: {\\n          'X-Shopify-Access-Token': shopifyApiKey,\\n          'Content-Type': 'application/json'\\n        },\\n        params: {\\n          'name': orderNumber,'status': 'any'\\n        }\\n      });\\n    } else {\\n      result = await req.get(shopifyApiOrderEndpoint, {\\n        headers: {\\n          'X-Shopify-Access-Token': shopifyApiKey,\\n          'Content-Type': 'application/json'\\n        }\\n      });\\n    }\\n    \\n    // order search return an array, so strip out the returned object\\n    if (searchMethod == \\\"orderByNumber\\\") {\\n      if (result.data.orders.length > 0){\\n        response = result.data.orders[0];  // Store the API response\\n      } else {\\n        // no data returned so set error variables\\n        global_var_set(\\\"global_custom.accShopify.errorCode\\\",3003);\\n        global_var_set(\\\"global_custom.accShopify.errorMessage\\\",\\\"Order not found\\\" + \\\" - [flow: \\\" + var_get()[\\\"FlowConfig.name\\\"] + \\\"] - [version: \\\" + var_get()[\\\"FlowConfig.version\\\"] + \\\"] - [block: \\\" + scriptBlockName + \\\"]\\\");\\n        return false;\\n      }\\n    } else if (searchMethod.startsWith(\\\"customer\\\")) {\\n      // successful order lookups already have the order ID so only 1 object is in the response to return\\n      response = result.data.order;\\n    } else {\\n      global_var_set(\\\"global_custom.accShopify.errorCode\\\",3003);\\n      global_var_set(\\\"global_custom.accShopify.errorMessage\\\",\\\"Order not found\\\");\\n      return false; \\n    }\\n\\n    var_set(\\\"data\\\",JSON.stringify(response));\\n    log.debug(JSON.stringify(response));\\n    return true;\\n  \\n  } catch (error) {\\n    log.debug(\\\"Unexpected error: \\\" + error + \\\" - [flow: \\\" + var_get()[\\\"FlowConfig.name\\\"] + \\\"] - [version: \\\" + var_get()[\\\"FlowConfig.version\\\"] + \\\"] - [block: \\\" + scriptBlockName + \\\"]\\\");\\n    global_var_set(\\\"global_custom.accShopify.errorCode\\\",9000);\\n    global_var_set(\\\"global_custom.accShopify.errorMessage\\\",\\\"Unexpected error: \\\" + error + \\\" - [flow: \\\" + var_get()[\\\"FlowConfig.name\\\"] + \\\"] - [version: \\\" + var_get()[\\\"FlowConfig.version\\\"] + \\\"] - [block: \\\" + scriptBlockName + \\\"]\\\");\\n    return false;\\n  }\\n}\\n\",\"language\":\"javascript\",\"name\":\"GetOrder\",\"sdkVersion\":2},\"transitions\":[{\"event\":\"Success\",\"friendlyName\":\"Success\",\"next\":\"CheckOrderFound\",\"id\":\"ec5398b3-c129-457d-b209-585e76027e2e\"},{\"event\":\"Fail\",\"friendlyName\":\"Fail\",\"next\":\"DisplayError\",\"id\":\"76236a10-e834-445e-8f0b-037f513763e0\"}]},{\"id\":\"7c973b79-ae37-4c03-a94b-3c22e06f7474\",\"name\":\"CheckOrderFound\",\"type\":\"Condition\",\"top\":1782,\"left\":3915,\"properties\":{\"type\":\"variable\",\"variable\":\"{{GetOrder.value}}\",\"queueId\":\"\"},\"transitions\":[{\"event\":\"noMatch\",\"next\":\"DisplayError\",\"friendlyName\":\"No Match\",\"id\":\"aa61a67d-58bd-41cc-a7c4-da2c220247eb\"},{\"id\":\"d13a531e-88f8-4994-af3e-cd55b6b97649\",\"event\":\"Match\",\"condition\":null,\"conditionList\":[{\"value\":\"true\",\"operator\":\"Equal to\",\"preOperator\":\"None\"}],\"friendlyName\":\"True\",\"categoryId\":\"\",\"skillId\":\"\",\"skillName\":\"\",\"next\":\"ProcessOrder\"}]},{\"id\":\"93f135cc-cc1c-4fc1-8e1a-ec31228246c2\",\"name\":\"ProcessOrder\",\"type\":\"Variable\",\"top\":1547.25,\"left\":3998.25,\"properties\":{\"script\":\"/*\\nINPUT PARAMETERS FOR DEBUGGING\\n\\n{\\n'GetOrder.data':'{\\\"fulfillment_status\\\":\\\"fulfilled\\\",\\\"customer\\\":{\\\"id\\\":6629291852093}}'\\n}\\n\\n*/\\n\\nasync function main () {\\n  const scriptBlockName = \\\"ProcessOrder\\\";\\n\\n  try {\\n    let response = JSON.parse(var_get()[\\\"GetOrder.data\\\"]);\\n\\n    global_var_set(\\\"global_custom.accShopify.orderId\\\", response.id);\\n    global_var_set(\\\"global_custom.accShopify.orderNumber\\\", response.order_number);\\n    global_var_set(\\\"global_custom.accShopify.orderStatus\\\", response.fulfillment_status);\\n    global_var_set(\\\"global_custom.accShopify.orderPaymentStatus\\\", response.financial_status);\\n    global_var_set(\\\"global_custom.accShopify.orderShippingAddress\\\", JSON.stringify(response.shipping_address));\\n    global_var_set(\\\"global_custom.accShopify.orderCancelReason\\\", response.cancel_reason);\\n    global_var_set(\\\"global_custom.accShopify.orderCancelledAt\\\", response.cancelled_at);\\n    global_var_set(\\\"global_custom.accShopify.orderLineItems\\\", JSON.stringify(response.line_items));\\n    global_var_set(\\\"global_custom.accShopify.orderNote\\\", response.note);\\n    global_var_set(\\\"global_custom.accShopify.orderPhone\\\", response.phone);\\n    global_var_set(\\\"global_custom.accShopify.orderTotalPrice\\\", response.total_price);\\n    // set the customer id from the cut-down customer object, so a full lookup can be done\\n    var_set(\\\"customerId\\\", response.customer.id);\\n    return true;\\n    \\n  } catch (error) {\\n    log.debug(\\\"Unexpected error: \\\" + error + \\\" - [flow: \\\" + var_get()[\\\"FlowConfig.name\\\"] + \\\"] - [version: \\\" + var_get()[\\\"FlowConfig.version\\\"] + \\\"] - [block: \\\" + scriptBlockName + \\\"]\\\");\\n    global_var_set(\\\"global_custom.accShopify.errorCode\\\",9000);\\n    global_var_set(\\\"global_custom.accShopify.errorMessage\\\",\\\"Unexpected error: \\\" + error + \\\" - [flow: \\\" + var_get()[\\\"FlowConfig.name\\\"] + \\\"] - [version: \\\" + var_get()[\\\"FlowConfig.version\\\"] + \\\"] - [block: \\\" + scriptBlockName + \\\"]\\\");\\n    return false;\\n  }\\n}\\n\\nfunction preventNull(valueToCheck){\\n  if (valueToCheck == null) {\\n    return \\\"\\\";\\n  } else {\\n    return valueToCheck;\\n  }\\n}\\n\",\"language\":\"javascript\",\"name\":\"ProcessOrder\",\"sdkVersion\":2},\"transitions\":[{\"event\":\"Success\",\"friendlyName\":\"Success\",\"next\":\"CheckProcessOrder\",\"id\":\"84aac20d-29cb-4f94-9673-d6837e47d378\"},{\"event\":\"Fail\",\"friendlyName\":\"Fail\",\"next\":\"DisplayError\",\"id\":\"963399f7-a257-41f5-a85e-9f0a2216d9e7\"}]},{\"id\":\"c860b9b5-3699-468c-a465-f89ecfa7ce3e\",\"name\":\"CheckProcessOrder\",\"type\":\"Condition\",\"top\":1690.25,\"left\":4384.5,\"properties\":{\"type\":\"variable\",\"variable\":\"{{ProcessOrder.value}}\",\"queueId\":\"\"},\"transitions\":[{\"event\":\"noMatch\",\"next\":\"DisplayError\",\"friendlyName\":\"No Match\",\"id\":\"947f87c9-67fd-4df0-8172-933534721326\"},{\"id\":\"f82cea18-27e7-4fbe-8717-1410a56eeab2\",\"event\":\"Match\",\"condition\":null,\"conditionList\":[{\"value\":\"true\",\"operator\":\"Equal to\",\"preOperator\":\"None\"}],\"friendlyName\":\"True\",\"categoryId\":\"\",\"skillId\":\"\",\"skillName\":\"\",\"next\":\"CustomerMissing\"}]},{\"id\":\"c1a72ac1-e4d5-4883-998f-433bec5a7b6b\",\"name\":\"CustomerMissing\",\"type\":\"Variable\",\"top\":1447.5,\"left\":4386,\"properties\":{\"script\":\"/*\\n\\nINPUT PARAMETERS FOR DEBUGGING\\n\\n{\\n\\\"GetCustomer.value\\\":\\\"true\\\",\\n\\\"FlowConfig.name\\\":\\\"DebugFlow\\\"\\n}\\n\\n*/\\n\\nasync function main () {\\n  const scriptBlockName = \\\"CustomerMissing\\\";\\n  \\n  // prevents infinite an loop by checking to see if the GetCustomer\\n  // block has already executed\\n  try {\\n    // has the customer script block already run?\\n    if (var_get()[\\\"GetCustomer.value\\\"] == null) {\\n      // no, so customer must be missing\\n      return true;\\n    } else {\\n      // customer block has already run\\n      return false;\\n    }\\n  } catch (error) {\\n    log.debug(\\\"Unexpected error: \\\" + error + \\\" - [flow: \\\" + var_get()[\\\"FlowConfig.name\\\"] + \\\"] - [version: \\\" + var_get()[\\\"FlowConfig.version\\\"] + \\\"] - [block: \\\" + scriptBlockName + \\\"]\\\");\\n    global_var_set(\\\"global_custom.accShopify.errorCode\\\",9000);\\n    global_var_set(\\\"global_custom.accShopify.errorMessage\\\",\\\"Unexpected error: \\\" + error + \\\" - [flow: \\\" + var_get()[\\\"FlowConfig.name\\\"] + \\\"] - [version: \\\" + var_get()[\\\"FlowConfig.version\\\"] + \\\"] - [block: \\\" + scriptBlockName + \\\"]\\\");\\n    return false;\\n  }\\n\\n}\\n\",\"language\":\"javascript\",\"name\":\"CustomerMissing\",\"sdkVersion\":2},\"transitions\":[{\"event\":\"Success\",\"friendlyName\":\"Success\",\"next\":\"CheckCustomerMissing\",\"id\":\"e31ec067-1246-4012-b2fb-d8076e608453\"},{\"event\":\"Fail\",\"friendlyName\":\"Fail\",\"next\":\"DisplayError\",\"id\":\"da55076a-719d-4762-bfce-dd763156e7fe\"}]},{\"id\":\"4e828054-f183-4230-b76d-2caffd520f81\",\"name\":\"CheckCustomerMissing\",\"type\":\"Condition\",\"top\":1257.75,\"left\":3999,\"properties\":{\"type\":\"variable\",\"variable\":\"{{CustomerMissing.value}}\",\"queueId\":\"\"},\"transitions\":[{\"event\":\"noMatch\",\"next\":\"DisplayError\",\"friendlyName\":\"No Match\",\"id\":\"a2bb8e63-9da9-4a20-a0cd-14bd68c96055\"},{\"id\":\"6ca558f2-fe49-470e-b154-bbb7420ec099\",\"event\":\"Match\",\"condition\":null,\"conditionList\":[{\"value\":\"true\",\"operator\":\"Equal to\",\"preOperator\":\"None\"}],\"friendlyName\":\"True\",\"categoryId\":\"\",\"skillId\":\"\",\"skillName\":\"\",\"next\":\"GetCustomer\"}]},{\"id\":\"89272632-1dd5-49bd-9423-ce1816085367\",\"name\":\"CheckProcessing\",\"type\":\"Condition\",\"top\":1072.25,\"left\":5272.5,\"properties\":{\"type\":\"variable\",\"variable\":\"{{ProcessCustomer.value}}\",\"queueId\":\"\"},\"transitions\":[{\"event\":\"noMatch\",\"next\":\"DisplayError\",\"friendlyName\":\"No Match\",\"id\":\"2f5b28bf-598a-4768-a23b-54a2138ad08d\"},{\"id\":\"8ec94792-d0b5-4a01-ab95-16145129ec66\",\"event\":\"Match\",\"condition\":null,\"conditionList\":[{\"value\":\"true\",\"operator\":\"Equal to\",\"preOperator\":\"None\"}],\"friendlyName\":\"True\",\"categoryId\":\"\",\"skillId\":\"\",\"skillName\":\"\",\"next\":\"OrderMissing\"}]},{\"id\":\"04619425-2e48-4c34-a126-137fc5256b6d\",\"name\":\"OrderMissing\",\"type\":\"Variable\",\"top\":1263.25,\"left\":5304.25,\"properties\":{\"script\":\"/*\\n\\nINPUT PARAMETERS FOR DEBUGGING\\n\\n{\\n\\\"GetOrder.value\\\":\\\"true\\\",\\n\\\"global_custom.accShopify.customerLastOrderId\\\":\\\"123\\\",\\n\\\"FlowConfig.name\\\":\\\"DebugFlow\\\"\\n}\\n\\n*/\\n\\nasync function main () {\\n  const scriptBlockName = \\\"OrderMissing\\\";  \\n  \\n  // prevents infinite an loop by checking to see if the GetOrder\\n  // block has already executed\\n  try {\\n    let lastOrderId = var_get()[\\\"global_custom.accShopify.customerLastOrderId\\\"];\\n    // has the customer placed at least one order?\\n    if (lastOrderId == null || lastOrderId == \\\"\\\") {\\n      // customer hasn't placed any orders\\n      return false;\\n    } else {\\n      // has the order script block already run?\\n      if (var_get()[\\\"GetOrder.value\\\"] == null) {\\n        // no, so order must be missing\\n        return true;\\n      } else {\\n        // order block has already run\\n        return false;\\n      }\\n    }\\n  } catch (error) {\\n    log.debug(\\\"Unexpected error: \\\" + error + \\\" - [flow: \\\" + var_get()[\\\"FlowConfig.name\\\"] + \\\"] - [version: \\\" + var_get()[\\\"FlowConfig.version\\\"] + \\\"] - [block: \\\" + scriptBlockName + \\\"]\\\");\\n    global_var_set(\\\"global_custom.accShopify.errorCode\\\",9000);\\n    global_var_set(\\\"global_custom.accShopify.errorMessage\\\",\\\"Unexpected error: \\\" + error + \\\" - [flow: \\\" + var_get()[\\\"FlowConfig.name\\\"] + \\\"] - [version: \\\" + var_get()[\\\"FlowConfig.version\\\"] + \\\"] - [block: \\\" + scriptBlockName + \\\"]\\\");\\n    return false;\\n  }\\n\\n}\\n\",\"language\":\"javascript\",\"name\":\"OrderMissing\",\"sdkVersion\":2},\"transitions\":[{\"event\":\"Success\",\"friendlyName\":\"Success\",\"next\":\"CheckOrderMissing\",\"id\":\"cb18c70c-e8ea-460b-8325-d09ff217e34a\"},{\"event\":\"Fail\",\"friendlyName\":\"Fail\",\"next\":\"DisplayError\",\"id\":\"98456776-ea01-4904-9a44-14be5fdee68f\"}]},{\"id\":\"9e199937-9ce7-4d16-8211-65827d9b5ad4\",\"name\":\"CheckOrderMissing\",\"type\":\"Condition\",\"top\":1798,\"left\":5755,\"properties\":{\"type\":\"variable\",\"variable\":\"{{OrderMissing.value}}\",\"queueId\":\"\"},\"transitions\":[{\"event\":\"noMatch\",\"next\":\"MainLogicComplete\",\"friendlyName\":\"No Match\",\"id\":\"f4c8c3bc-5da0-4cdd-b35f-6bdea52539eb\"},{\"id\":\"a3632fa3-f62e-4779-bbf2-1a5abb29ca2a\",\"event\":\"Match\",\"condition\":null,\"conditionList\":[{\"value\":\"true\",\"operator\":\"Equal to\",\"preOperator\":\"None\"}],\"friendlyName\":\"True\",\"categoryId\":\"\",\"skillId\":\"\",\"skillName\":\"\",\"next\":\"GetOrder\"}]},{\"id\":\"6401941f-102e-4d97-8332-cda55af90646\",\"name\":\"MainLogicComplete\",\"type\":\"Variable\",\"top\":1670.142857142857,\"left\":6154.857142857143,\"properties\":{\"script\":\"/*\\n-------------------------------------------------------------------------------\\nPLEASE NOTE\\n-------------------------------------------------------------------------------\\nThis script returns true and contains no logic.\\nIt acts as a single place to mark the end of the data retrieval blocks before \\nthe post-execution blocks aare called.\\n\\nWhen modifying your flow to include your own post-execution logic, update\\nthe exit point of this block to link to the block where your own logic starts.\\n-------------------------------------------------------------------------------\\n*/\\n\\nasync function main () {\\n  return true;\\n}\\n\",\"language\":\"javascript\",\"name\":\"MainLogicComplete\",\"sdkVersion\":2},\"transitions\":[{\"event\":\"Success\",\"friendlyName\":\"Success\",\"next\":\"PostSetCustomerData\",\"id\":\"5024eba4-8027-4729-801a-1c543cfed122\"},{\"event\":\"Fail\",\"friendlyName\":\"Fail\",\"next\":\"PostSetCustomerData\",\"id\":\"d823bd48-1a8b-4546-a8cc-b446ab5ea301\"}]},{\"id\":\"85147c80-0ee5-4699-9665-5b6646ee9087\",\"name\":\"PostSetCustomerData\",\"type\":\"Variable\",\"top\":1626.5,\"left\":6823.75,\"properties\":{\"script\":\"/*\\nINPUT PARAMETERS FOR DEBUGGING\\n\\n{\\n\\\"FlowConfig.Name\\\":\\\"DebugFlow\\\"\\n}\\n\\n*/\\n\\nasync function main () {\\n  const scriptBlockName = \\\"OrderExists\\\";\\n  try { \\n    let customerPhone = (var_get()[\\\"global_custom.accShopify.customerPhone\\\"] != null) ? var_get()[\\\"global_custom.accShopify.customerPhone\\\"] : \\\"null\\\";\\n    let customerLastOrderId = (var_get()[\\\"global_custom.accShopify.customerLastOrderId\\\"] != null) ? var_get()[\\\"global_custom.accShopify.customerLastOrderId\\\"] : \\\"null\\\";\\n    let customerNote = (var_get()[\\\"global_custom.accShopify.customerNote\\\"] != null) ? var_get()[\\\"global_custom.accShopify.customerNote\\\"] : \\\"null\\\";\\n\\tlet customerState = (var_get()[\\\"global_custom.accShopify.customerState\\\"] != null) ? var_get()[\\\"global_custom.accShopify.customerState\\\"] : \\\"null\\\";\\n    let customerTags = (var_get()[\\\"global_custom.accShopify.customerTags\\\"] != null) ? var_get()[\\\"global_custom.accShopify.customerTags\\\"] : \\\"null\\\";\\n    \\n    // use local variables for any nullable values - this prevents issues when displaying in the SendMedia block\\n    var_set(\\\"customerPhone\\\", \\\"customerPhone: \\\" + customerPhone);\\n    var_set(\\\"customerLastOrderId\\\", \\\"customerLastOrderId: \\\" + customerLastOrderId);\\n    var_set(\\\"customerNote\\\", \\\"customerNote: \\\" + customerNote);\\n    var_set(\\\"customerState\\\", \\\"customerState: \\\" + customerState);\\n    var_set(\\\"customerTags\\\", \\\"customerTags: \\\" + customerTags);\\n    return true;\\n    \\n  } catch (error) {\\n    log.debug(\\\"Unexpected error: \\\" + error + \\\" - [flow: \\\" + var_get()[\\\"FlowConfig.name\\\"] + \\\"] - [version: \\\" + var_get()[\\\"FlowConfig.version\\\"] + \\\"] - [block: \\\" + scriptBlockName + \\\"]\\\");\\n    global_var_set(\\\"global_custom.accShopify.errorCode\\\",9000);\\n    global_var_set(\\\"global_custom.accShopify.errorMessage\\\",\\\"Unexpected error: \\\" + error + \\\" - [flow: \\\" + var_get()[\\\"FlowConfig.name\\\"] + \\\"] - [version: \\\" + var_get()[\\\"FlowConfig.version\\\"] + \\\"] - [block: \\\" + scriptBlockName + \\\"]\\\");\\n    return false;\\n  }\\n}\",\"language\":\"javascript\",\"name\":\"PostSetCustomerData\",\"sdkVersion\":2},\"transitions\":[{\"event\":\"Success\",\"friendlyName\":\"Success\",\"next\":\"PostReadCustomer\",\"id\":\"317cc09e-7d36-4612-a77b-2bf07808ceb9\"},{\"event\":\"Fail\",\"friendlyName\":\"Fail\",\"next\":\"PostDisplayError\",\"id\":\"1cac2ddc-ea13-4291-8026-56b51424c054\"}]},{\"id\":\"0926ead4-fa34-4693-a412-0ed5bddd2cab\",\"name\":\"PostDisplayError\",\"type\":\"SendMedia\",\"top\":2381,\"left\":7230.25,\"properties\":{\"media_type\":\"audio\",\"promptAudioId\":\"\",\"promptAudioName\":\"\",\"enablePromptAudio\":false,\"allowInterrupt\":true,\"_isPublicPromptAudio\":false,\"audioList\":[{\"id\":\"0738c4e8-3a7d-45d8-b3fb-342d4e8ee8bd\",\"type\":\"speechAudio\",\"voice_id\":\"Joanna\",\"lang\":\"en-US\",\"asset_id\":\"\",\"asset_name\":\"\",\"message\":\"Oooops!  Something went wrong...\\nError code: {{global_custom.accShopify.errorCode}};\\nError message: {{global_custom.accShopify.errorMessage}}\",\"_publicAsset\":false,\"file_id\":\"\"}],\"videoList\":[{\"id\":\"dc5fa8a4-f6a8-42cd-9359-88863c5d1ec1\",\"type\":\"assetVideo\",\"asset_id\":\"\",\"asset_name\":\"\",\"_publicAsset\":false,\"text\":\"\",\"enableText\":true,\"enableImage\":false}],\"chatList\":[{\"id\":\"163766d5-6776-4e0a-856d-031e2caa51f7\",\"type\":\"assetImage\",\"asset_id\":\"\",\"asset_name\":\"\",\"text\":{},\"audio_id\":\"\",\"enableText\":true,\"enableImage\":false,\"enableAudio\":false,\"audio_name\":\"\",\"_publicAudio\":false}],\"slidesList\":[{\"id\":\"5837d271-6cde-4fa2-9cde-037b3bbda174\",\"type\":\"assetSlides\",\"asset_id\":\"\",\"asset_name\":\"\",\"_publicAsset\":false}],\"cardList\":[{\"id\":\"734fba3e-fcf2-4839-a61b-600a043ea354\",\"asset_id\":\"\",\"text\":\"\"}]},\"transitions\":[{\"event\":\"next\",\"next\":null,\"id\":\"424ffff4-154f-44fa-8669-57d6314377a5\",\"friendlyName\":\"Next Step\"},{\"event\":\"sendMediaFailed\",\"friendlyName\":\"Send Media Failed\",\"_tooltip\":\"Media failed to send to the end customer\",\"next\":null,\"id\":\"42f71277-084b-46e8-94b0-a8c4ff12215d\"}]},{\"id\":\"d25bf144-92ac-4d7c-b798-e5a1c4657cc0\",\"name\":\"PostReadCustomer\",\"type\":\"SendMedia\",\"top\":1681,\"left\":7365,\"properties\":{\"media_type\":\"audio\",\"promptAudioId\":\"\",\"promptAudioName\":\"\",\"enablePromptAudio\":false,\"allowInterrupt\":true,\"_isPublicPromptAudio\":false,\"audioList\":[{\"id\":\"6dbb029e-f646-4aa8-aebd-11206cc4fb0c\",\"type\":\"speechAudio\",\"voice_id\":\"Joanna\",\"lang\":\"en-US\",\"asset_id\":\"\",\"asset_name\":\"\",\"message\":\"This customer has been found, and variables have been set within the a c c Shopify group:\",\"_publicAsset\":false,\"file_id\":\"\"},{\"id\":\"d6b0edc9-f97a-442f-9496-42d260f6e920\",\"type\":\"speechAudio\",\"lang\":\"en-US\",\"voice_id\":\"Joanna\",\"asset_id\":\"\",\"asset_name\":\"\",\"message\":\"Customer ID: {{global_custom.accShopify.customerId}}\\nCustomer name: {{global_custom.accShopify.customerFirstName}}\\n{{global_custom.accShopify.customerLastName}}\\nOrder count: {{global_custom.accShopify.customerOrdersCount}}\",\"file_id\":\"\"}],\"videoList\":[{\"id\":\"3356dfdd-f9cc-4cec-8ed1-7527aa3ba519\",\"type\":\"assetVideo\",\"asset_id\":\"\",\"asset_name\":\"\",\"_publicAsset\":false,\"text\":\"\",\"enableText\":true,\"enableImage\":false}],\"chatList\":[{\"id\":\"ec60346a-3413-49ed-9668-7256adcf8a76\",\"type\":\"assetImage\",\"asset_id\":\"\",\"asset_name\":\"\",\"text\":{},\"audio_id\":\"\",\"enableText\":true,\"enableImage\":false,\"enableAudio\":false,\"audio_name\":\"\",\"_publicAudio\":false}],\"slidesList\":[{\"id\":\"2f4cc25d-8775-45c2-8ed4-0def01c20f5e\",\"type\":\"assetSlides\",\"asset_id\":\"\",\"asset_name\":\"\",\"_publicAsset\":false}],\"cardList\":[{\"id\":\"72f95a4d-9bca-4506-8c90-7ef7e8b008e4\",\"asset_id\":\"\",\"text\":\"\"}]},\"transitions\":[{\"event\":\"next\",\"next\":\"PostGetOrderExists\",\"id\":\"56aeee17-af26-45ef-ab89-f9100a3e9699\",\"friendlyName\":\"Next Step\"},{\"event\":\"sendMediaFailed\",\"friendlyName\":\"Send Media Failed\",\"_tooltip\":\"Media failed to send to the end customer\",\"next\":\"PostDisplayError\",\"id\":\"4b5ecd6d-50b9-4ba1-a22e-5072243e1cd3\"}]},{\"id\":\"19ce44e0-9382-4014-bfaa-4b436dee4071\",\"name\":\"PostGetOrderExists\",\"type\":\"Variable\",\"top\":1833.75,\"left\":7833,\"properties\":{\"script\":\"/*\\nINPUT PARAMETERS FOR DEBUGGING\\n\\n{\\n\\\"global_custom.accShopify.orderId\\\":123456,\\n\\\"FlowConfig.Name\\\":\\\"DebugFlow\\\"\\n}\\n\\n*/\\n\\nasync function main () {\\n  const scriptBlockName = \\\"OrderExists\\\";\\n  try {\\n    let orderId = var_get()[\\\"global_custom.accShopify.orderId\\\"];\\n    let orderStatus = (var_get()[\\\"global_custom.accShopify.orderStatus\\\"] != null) ? var_get()[\\\"global_custom.accShopify.orderStatus\\\"] : \\\"null\\\";\\n    let orderPaymentStatus = (var_get()[\\\"global_custom.accShopify.orderPaymentStatus\\\"] != null) ? var_get()[\\\"global_custom.accShopify.orderPaymentStatus\\\"] : \\\"null\\\";\\n    let orderCancelReason = (var_get()[\\\"global_custom.accShopify.orderCancelReason\\\"] != null) ? var_get()[\\\"global_custom.accShopify.orderCancelReason\\\"] : \\\"null\\\";\\n    let orderCancelledAt = (var_get()[\\\"global_custom.accShopify.orderCancelledAt\\\"] != null) ? var_get()[\\\"global_custom.accShopify.orderCancelledAt\\\"] : \\\"null\\\";\\n\\tlet orderNote = (var_get()[\\\"global_custom.accShopify.orderNote\\\"] != null) ? var_get()[\\\"global_custom.accShopify.orderNote\\\"] : \\\"null\\\";\\n    let orderPhone = (var_get()[\\\"global_custom.accShopify.orderPhone\\\"] != null) ? var_get()[\\\"global_custom.accShopify.orderPhone\\\"] : \\\"null\\\";\\n\\tlet orderTotalPrice = (var_get()[\\\"global_custom.accShopify.orderTotalPrice\\\"] != null) ? var_get()[\\\"global_custom.accShopify.orderTotalPrice\\\"] : \\\"null\\\";\\n    \\n    if (orderId == null || orderId == \\\"\\\") {\\n      return false;\\n    } else {\\n      // use local variables for any nullable values - this prevents issues when displaying in the SendMedia block\\n      var_set(\\\"orderStatus\\\", \\\"orderStatus: \\\" + orderStatus);\\n      var_set(\\\"orderPaymentStatus\\\", \\\"orderPaymentStatus: \\\" + orderPaymentStatus);\\n      var_set(\\\"orderCancelReason\\\", \\\"orderCancelReason: \\\" + orderCancelReason);\\n      var_set(\\\"orderCancelledAt\\\", \\\"orderCancelledAt: \\\" + orderCancelledAt);\\n      var_set(\\\"orderNote\\\", \\\"orderNote: \\\" + orderNote);\\n      var_set(\\\"orderPhone\\\", \\\"orderPhone: \\\" + orderPhone);\\n      var_set(\\\"orderTotalPrice\\\", \\\"orderTotalPrice: \\\" + orderTotalPrice);      \\n      return true;\\n    }\\n  } catch (error) {\\n    log.debug(\\\"Unexpected error: \\\" + error + \\\" - [flow: \\\" + var_get()[\\\"FlowConfig.name\\\"] + \\\"] - [version: \\\" + var_get()[\\\"FlowConfig.version\\\"] + \\\"] - [block: \\\" + scriptBlockName + \\\"]\\\");\\n    global_var_set(\\\"global_custom.accShopify.errorCode\\\",9000);\\n    global_var_set(\\\"global_custom.accShopify.errorMessage\\\",\\\"Unexpected error: \\\" + error + \\\" - [flow: \\\" + var_get()[\\\"FlowConfig.name\\\"] + \\\"] - [version: \\\" + var_get()[\\\"FlowConfig.version\\\"] + \\\"] - [block: \\\" + scriptBlockName + \\\"]\\\");\\n    return false;\\n  }\\n}\",\"language\":\"javascript\",\"name\":\"PostGetOrderExists\",\"sdkVersion\":2},\"transitions\":[{\"event\":\"Success\",\"friendlyName\":\"Success\",\"next\":\"PostCheckOrderExists\",\"id\":\"e8dd8bf9-38c7-457a-a4d0-4f3e0d4ee0ad\"},{\"event\":\"Fail\",\"friendlyName\":\"Fail\",\"next\":\"PostDisplayError\",\"id\":\"a9f5e9d7-170a-4ea1-83fd-5d51dbd7fa74\"}]},{\"id\":\"06abcd16-4931-403e-9efc-7f5bd7eebaa6\",\"name\":\"PostCheckOrderExists\",\"type\":\"Condition\",\"top\":1985.25,\"left\":8212,\"properties\":{\"type\":\"variable\",\"variable\":\"{{PostGetOrderExists.value}}\",\"queueId\":\"\"},\"transitions\":[{\"event\":\"noMatch\",\"next\":null,\"friendlyName\":\"No Match\",\"id\":\"ba0e20ff-0622-44e9-8234-36e1a10c7d00\"},{\"id\":\"98026bca-290c-4f6d-b60e-d7c0c2710570\",\"event\":\"Match\",\"condition\":null,\"conditionList\":[{\"value\":\"true\",\"operator\":\"Equal to\",\"preOperator\":\"None\"}],\"friendlyName\":\"True\",\"categoryId\":\"\",\"skillId\":\"\",\"skillName\":\"\",\"next\":\"PostReadOrder\"}]},{\"id\":\"a6a432a4-d175-400d-8e08-8d66b6805447\",\"name\":\"PostReadOrder\",\"type\":\"SendMedia\",\"top\":2149.5,\"left\":8622.5,\"properties\":{\"media_type\":\"audio\",\"promptAudioId\":\"\",\"promptAudioName\":\"\",\"enablePromptAudio\":false,\"allowInterrupt\":true,\"_isPublicPromptAudio\":false,\"audioList\":[{\"id\":\"6dbb029e-f646-4aa8-aebd-11206cc4fb0c\",\"type\":\"speechAudio\",\"voice_id\":\"Joanna\",\"lang\":\"en-US\",\"asset_id\":\"\",\"asset_name\":\"\",\"message\":\"This order has been found, and variables have been set within the a c c Shopify group:\",\"_publicAsset\":false,\"file_id\":\"\"},{\"id\":\"d6b0edc9-f97a-442f-9496-42d260f6e920\",\"type\":\"speechAudio\",\"lang\":\"en-US\",\"voice_id\":\"Joanna\",\"asset_id\":\"\",\"asset_name\":\"\",\"message\":\"Order ID: {{global_custom.accShopify.orderId}}\\nOrder Number: {{global_custom.accShopify.orderNumber}}\\nOrder Total Price: {{global_custom.accShopify.orderTotalPrice}}\",\"file_id\":\"\"}],\"videoList\":[{\"id\":\"3356dfdd-f9cc-4cec-8ed1-7527aa3ba519\",\"type\":\"assetVideo\",\"asset_id\":\"\",\"asset_name\":\"\",\"_publicAsset\":false,\"text\":\"\",\"enableText\":true,\"enableImage\":false}],\"chatList\":[{\"id\":\"ec60346a-3413-49ed-9668-7256adcf8a76\",\"type\":\"assetImage\",\"asset_id\":\"\",\"asset_name\":\"\",\"text\":{},\"audio_id\":\"\",\"enableText\":true,\"enableImage\":false,\"enableAudio\":false,\"audio_name\":\"\",\"_publicAudio\":false}],\"slidesList\":[{\"id\":\"2f4cc25d-8775-45c2-8ed4-0def01c20f5e\",\"type\":\"assetSlides\",\"asset_id\":\"\",\"asset_name\":\"\",\"_publicAsset\":false}],\"cardList\":[{\"id\":\"72f95a4d-9bca-4506-8c90-7ef7e8b008e4\",\"asset_id\":\"\",\"text\":\"\"}]},\"transitions\":[{\"event\":\"next\",\"next\":null,\"id\":\"a1ea753e-d1b6-47e5-85a0-4dd5d2e5557a\",\"friendlyName\":\"Next Step\"},{\"event\":\"sendMediaFailed\",\"friendlyName\":\"Send Media Failed\",\"_tooltip\":\"Media failed to send to the end customer\",\"next\":\"PostDisplayError\",\"id\":\"48c68668-9081-44e7-be97-23512f4b9c52\"}]}]}"}